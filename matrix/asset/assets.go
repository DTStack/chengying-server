// Licensed to Apache Software Foundation(ASF) under one or more contributor
// license agreements. See the NOTICE file distributed with
// this work for additional information regarding copyright
// ownership. Apache Software Foundation(ASF) licenses this file to you under
// the Apache License, Version 2.0 (the "License"); you may
// not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.

// Code generated by go-bindata.
// sources:
// templates/check-agent-exit.sh
// templates/cluster-net-check.sh
// templates/docker.environment.init.sh
// templates/environment.init.sh
// templates/health-check.sh
// templates/import-cluster-resource-v1beta1.yml
// templates/import-cluster-resource.yml
// templates/import-ns-resouce.yml
// templates/install.agentx.sh
// templates/install.script.wrapper.sh
// templates/list-files.sh
// templates/net-check.sh
// templates/patchupdate.sh
// templates/role-permissions.yml
// templates/selfbuild-component-v1beta1.yml
// templates/selfbuild-component.yml
// DO NOT EDIT!

package asset

import (
	"fmt"
	"io/ioutil"
	"os"
	"path/filepath"
	"strings"
	"time"
)

type asset struct {
	bytes []byte
	info  os.FileInfo
}

type bindataFileInfo struct {
	name    string
	size    int64
	mode    os.FileMode
	modTime time.Time
}

func (fi bindataFileInfo) Name() string {
	return fi.name
}
func (fi bindataFileInfo) Size() int64 {
	return fi.size
}
func (fi bindataFileInfo) Mode() os.FileMode {
	return fi.mode
}
func (fi bindataFileInfo) ModTime() time.Time {
	return fi.modTime
}
func (fi bindataFileInfo) IsDir() bool {
	return false
}
func (fi bindataFileInfo) Sys() interface{} {
	return nil
}

var _templatesCheckAgentExitSh = []byte(`#!/bin/sh

current=` + "`" + `date "+%Y-%m-%d %H:%M:%S"` + "`" + `
timeStamp=` + "`" + `date -d "$current" +%s` + "`" + `

agentId={AGENTID}
interval={INTERVAL}

#agentId=cd3d4341-e9ad-446d-9932-8884a034d1cb
#interval=28

logs=/opt/dtstack/easymanager/easyagent/logs/agent.log

cdate=` + "`" + `date -d "-$interval hour" +"%Y/%m/%d %H"` + "`" + `

user=` + "`" + `whoami` + "`" + `
s=0

for i in $(cat $logs |grep "$cdate"|grep "exit(exit status 1"|grep "$agentId"| awk '{print$1"#"$2}')
do
ret=` + "`" + `echo $(echo $(echo "$i"|sed "s/\//-/g")| sed "s/AGENT-DEBUG://g" )|sed "s/#/ /g"` + "`" + `
results[s]='{"start_time":{"desc":"启动时间","value":"'$ret'"},"service_name":{"desc":"启动服务","value":"{SERVICENAME}"},"host":{"desc":"启动主机","value":"{HOSTIP}"},"product_name":{"desc":"所属组件","value":"{PRODUCTNAME}"},"run_user":{"desc":"启动用户","value":"'$user'"}}'
s=$[$s+1];
done

len=${#results[@]}
for ((i=$len - 1;i>=0;i--))
do
    echo ${results[$i]}
done`)

func templatesCheckAgentExitShBytes() ([]byte, error) {
	return _templatesCheckAgentExitSh, nil
}

func templatesCheckAgentExitSh() (*asset, error) {
	bytes, err := templatesCheckAgentExitShBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/check-agent-exit.sh", size: 891, mode: os.FileMode(420), modTime: time.Unix(1638428450, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesClusterNetCheckSh = []byte(`#!/bin/sh

#usage ./cluster_net_check.sh user emip [ip]
#parameter 1 is ssh user no password
#parameter 2 is em host
#parameters after 2 are list of host ip to check
# if not passed, some red error appears

if [ $# -lt 2 ] ; then
  echo "USAGE: $0 user [ip]"
  exit
fi

red(){
    CONTENT=$1
    echo -e "\033[31m${CONTENT}\033[0m"
    exit 1
}

green(){
    CONTENT=$1
    echo -e "\033[32m${CONTENT}\033[0m"
}

yellow(){
    CONTENT=$1
    echo -e "\033[33m${CONTENT}\033[0m"
}

user=$1
em_host=$2
shift
shift
i=$@

for i in "$@"; do
    yellow "\n\n===========================check $i？=====================================\n"
    scp net-check.sh $user@$i:/tmp/
    ssh $user@$i "sh /tmp/net-check.sh $em_host 8889 8890"
done
`)

func templatesClusterNetCheckShBytes() ([]byte, error) {
	return _templatesClusterNetCheckSh, nil
}

func templatesClusterNetCheckSh() (*asset, error) {
	bytes, err := templatesClusterNetCheckShBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/cluster-net-check.sh", size: 731, mode: os.FileMode(420), modTime: time.Unix(1638428450, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesDockerEnvironmentInitSh = []byte(`#!/bin/bash

STATIC_HOST='{{.STATIC_HOST}}'
REGISTRY_HOST='{{.MATRIX_IP}}'

install_docker(){
    curl -L -O -s "$STATIC_HOST/easyagent/dtstack-docker.tar.gz"
    tar -xf "dtstack-docker.tar.gz" -C /opt/dtstack/

    sh /opt/dtstack/dtstack-docker/install.sh $REGISTRY_HOST
}

install_docker`)

func templatesDockerEnvironmentInitShBytes() ([]byte, error) {
	return _templatesDockerEnvironmentInitSh, nil
}

func templatesDockerEnvironmentInitSh() (*asset, error) {
	bytes, err := templatesDockerEnvironmentInitShBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/docker.environment.init.sh", size: 291, mode: os.FileMode(420), modTime: time.Unix(1638428450, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesEnvironmentInitSh = []byte(`#!/bin/sh
set -x
STATIC_HOST='{{.STATIC_HOST}}'
NTP_SERVER='{{.NTP_SERVER}}'

cd ` + "`" + `dirname $0` + "`" + `
PWD=` + "`" + `pwd` + "`" + `
#source ../../conf/host.conf
#IPS=` + "`" + `echo $all_host | tr ',' '\n'` + "`" + `
red(){
    CONTENT=$1
#    echo -e "\033[31m${CONTENT}\033[0m"
    echo "${CONTENT}"
    exit 1
}

green(){
    CONTENT=$1
#    echo -e "\033[32m${CONTENT}\033[0m"
}

yellow(){
    CONTENT=$1
#    echo -e "\033[33m${CONTENT}\033[0m"
}

check_data_dir(){
    sudo mkdir -p /data
    sudo chown ` + "`" + `whoami` + "`" + `:` + "`" + `whoami` + "`" + ` /data
}

check_User(){
    sudo cut -d : -f 1 /etc/passwd |grep $1 >/dev/null 2>&1
    if [ $? != 0 ];then
        sudo groupadd $1
        sudo useradd -g $1 $1
        if [ $? != 0 ];then
            red "New user $1 failed";exit
        fi
    else
        green "User $1 already exits"
    fi
}


install_arthas(){
 # TEMP_ARTHAS_FILE="./as.sh.$$"
  mkdir /opt/dtstack/
  curl -L -O -s "$STATIC_HOST/easyagent/arthas.tar.gz"
  tar -xf "arthas.tar.gz" -C /opt/dtstack/
#  curl -L -O -s "$STATIC_HOST/easyagent/

}
installyum(){
    yellow "\n\n===========================Yum install=====================================\n"
cat <<EOF | sudo tee /etc/yum.repos.d/dtstack.repo > /dev/null
[dtstack]
name=dtstack
cost=2000
priority=99
baseurl=$STATIC_HOST/easyagent/dtstack-repos
enable=1
gpgcheck=0
EOF

    sudo yum --disablerepo=\* --enablerepo=dtstack -y clean all >/dev/null 2>&1
    sudo yum --disablerepo=\* --enablerepo=dtstack -y makecache >/dev/null 2>&1
    sudo yum --disablerepo=\* --enablerepo=dtstack -y install curl unzip python-devel libaio perl nc ntp ntpdate epel-release python2-pip rsync psmisc unixODBC libicu kubectl openssh >/dev/null 2>&1
    exit_status=$?
    if [ $exit_status -eq 0 ]; then
        green "yum install success"
    else
        sudo yum -y install curl unzip python-devel libaio* perl nc ntp ntpdate epel-release python2-pip rsync psmisc unixODBC libicu node_exporter>/dev/null 2>&1
        exit_status=$?
        if [ $exit_status -eq 0 ]; then
            green "yum install success"
        else
            red "yum install failed"
        fi
    fi
}

check_umask(){
    yellow "\n\n===========================Check umask=====================================\n"
    Umask=` + "`" + `umask` + "`" + `
    if [ $Umask == 0022 ];then
      yellow "umask is 0022"
    else
      umask 0022
      echo "umask 0022" |sudo tee -a /etc/profile > /dev/null
    fi

}

check_iptables(){
    yellow "\n\n===========================iptabls已关闭？=====================================\n"
    # iptables
    sudo service iptables stop >/dev/null 2>&1
    sudo chkconfig iptables off >/dev/null 2>&1
    sudo service iptables status >/dev/null 2>&1
    exit_status=$?
    if [ $exit_status -ne 0 ]; then
        green "iptables is closed"
    else
        red "iptables is not closed"
    fi
}

check_firewalld(){
    yellow "\n\n===========================iptabls已关闭？=====================================\n"
    # iptables
    sudo systemctl stop firewalld >/dev/null 2>&1
    sudo systemctl is-enabled firewalld >/dev/null 2>&1
    if [ $? == 0 ]; then
      sudo systemctl disable firewalld >/dev/null 2>&1
    fi
}

check_selinux(){
    yellow "\n\n===========================selinux已关闭？=====================================\n"
    sudo /usr/sbin/getenforce | grep -i "disabled" >/dev/null 2>&1
    exit_status=$?
    if [ $exit_status -eq 0 ]; then
      green "selinux is disabled"
    else
      sudo /usr/sbin/setenforce 0
      yellow "selinux is enabled"
      sudo sed -i 's/^SELINUX=\(.*\)/SELINUX=disabled/g' /etc/selinux/config
    fi

}

check_ping(){
    for ip in ` + "`" + `echo $1 | tr ',' '\n'` + "`" + `
    do
        ping -c 1 -w 5 $ip >> /dev/null
        exit_status=$?
        if [ $exit_status -eq 0 ]; then
            green "$2 $ip ping is enabled"
        else
            red "$2 $ip ping is disabled"
        fi
    done
}

check_all_ping(){
    yellow "\n\n===========================ping已开通？=====================================\n"
  check_ping $all_host  all_host
#  check_ping $ftp_host
  check_ping $redis_host  redis_host
  check_ping $rabbitmq_host  rabbitmq_host
  check_ping $db_host    db_host
  check_ping $web_host   web_host
  check_ping $es_host   es_host
  check_ping $jlogstash_host  jlogstash
  check_ping $kafka_host    kafka
  check_ping $zk_host   zk
  f_host=` + "`" + `echo $ftp_host  | awk -F '//' '{print $2}'` + "`" + `
  check_ping $f_host   ftp

}



check_sysctl(){
     yellow "\n\n===========================sysctl conf=====================================\n"
cat <<'EOF' | sudo tee /etc/sysctl.d/sidecar.conf > /dev/null
vm.max_map_count=655300
vm.overcommit_memory=1
vm.swappiness=0
net.ipv4.ip_forward=1
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 1200
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_max_tw_buckets = 5000
EOF
sudo systemctl restart systemd-sysctl >/dev/null 2>&1
}


check_limits(){
    yellow "\n\n===========================ulimits已设置？=====================================\n"
cat <<'LIMIT' | sudo tee /etc/security/limits.d/90-nproc.conf > /dev/null
* soft nproc 655350
* hard nproc 655350
LIMIT

cat <<'DEF' | sudo tee /etc/security/limits.d/def.conf > /dev/null
* soft nproc 655350
* hard nproc 655350
DEF

cat <<'EOF' | sudo tee /etc/security/limits.conf > /dev/null
# End of file
* soft nproc 655350
* hard nproc 655350
* soft nofile 655350
* hard nofile 655350
* - memlock unlimited
EOF

    green "ulimit is success"

    sudo sed -i 's#^PATH\(.*\)#PATH="/opt/java/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin"#g' /etc/init.d/functions
}



check_java(){
    yellow "\n\n===========================java已安装？=====================================\n"

#    host=` + "`" + `echo $ftp_host  | awk -F '//' '{print $2}'` + "`" + `
    #check_port 21 FTP
    if [ -f "/opt/dtstack/java/bin/java" ];then
        green "java success"
    else
        sudo rpm -i "$STATIC_HOST/easyagent/dtstack-java.noarch.rpm"
        if [ ! -f "/opt/dtstack/java/bin/java" ];then
            red "java install fild"
        fi
    fi
}

check_pip_depends(){
    yellow "\n\n===========================python depends[elasticsearch/MySQL-python/redis/pykafka/kazoo/zk_shell]已安装？=====================================\n"

    which pip >/dev/null 2>&1
    if [ $? != 0 ]; then
        yellow "pip install failed"
    else
        sudo pip install --disable-pip-version-check --retries=1 --timeout=1 elasticsearch redis pykafka kazoo zk_shell MySQL-python >/dev/null 2>&1

        exit_status=$?
        if [ $exit_status -eq 0 ]; then
            green "pip depends install success"
        else
            yellow "pip install failed, try install python depends from local package"
            curl -L -O -s "$STATIC_HOST/easyagent/packages.tar.gz"
            tar -xf "packages.tar.gz"

            if [ -d packages ];then
                sudo pip install --no-index --find-links=./packages elasticsearch redis pykafka kazoo zk_shell MySQL-python >/dev/null 2>&1
                exit_status=$?
                if [ $exit_status -eq 0 ]; then
                    green "pip depends install from local success "
                else
                    yellow "pip depends install from local failed"
                fi
            else
                yellow "no local pip packages"
            fi
        fi
    fi
}

check_ssh_nopwd(){
    yellow "\n\n===========================ssh免密码登陆已设置？=====================================\n"

    mkdir -p ~/.ssh
    echo "StrictHostKeyChecking no" > ~/.ssh/config
    echo "UserKnownHostsFile /dev/null" >> ~/.ssh/config
cat <<'EOF' >> ~/.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDQQtDR6WayM5FgxW7oXRYXJ/g7U7LTGVjCvkJScb6Xf8Um6CwZuFymTd7oVwrY95895AY0mSige0Qn0Q1lGTgxOul+pOcEDdhYsYpFXZnnb/CHtikEsKHAOAPm738Rk9lCFmGuXYHg0ova83qTvgwtw/jh8agIpPU3wnv7lcH3PR20RXM6qF/DUOOgsxTXwug7y4OJwMse2nX/FvcxTp1GRdd8OhUWHosc6sQaaIkoudVPQpnYFIq1Z+QOel8/0Ic0CUSezLeaHX9h0TfdDz85WO4yyBTzOE/O85NragbSPxYJ+WNsyRBajaXRsRmYjT4ug69r1CPZXrVYpWe0FpZZ
EOF
cat <<'EOF' > ~/.ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDQQtDR6WayM5FgxW7oXRYXJ/g7U7LTGVjCvkJScb6Xf8Um6CwZuFymTd7oVwrY95895AY0mSige0Qn0Q1lGTgxOul+pOcEDdhYsYpFXZnnb/CHtikEsKHAOAPm738Rk9lCFmGuXYHg0ova83qTvgwtw/jh8agIpPU3wnv7lcH3PR20RXM6qF/DUOOgsxTXwug7y4OJwMse2nX/FvcxTp1GRdd8OhUWHosc6sQaaIkoudVPQpnYFIq1Z+QOel8/0Ic0CUSezLeaHX9h0TfdDz85WO4yyBTzOE/O85NragbSPxYJ+WNsyRBajaXRsRmYjT4ug69r1CPZXrVYpWe0FpZZ
EOF

cat <<'EOF' > ~/.ssh/id_rsa
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA0ELQ0elmsjORYMVu6F0WFyf4O1Oy0xlYwr5CUnG+l3/FJugs
Gbhcpk3e6FcK2PefPeQGNJkooHtEJ9ENZRk4MTrpfqTnBA3YWLGKRV2Z52/wh7Yp
BLChwDgD5u9/EZPZQhZhrl2B4NKL2vN6k74MLcP44fGoCKT1N8J7+5XB9z0dtEVz
Oqhfw1DjoLMU18LoO8uDicDLHtp1/xb3MU6dRkXXfDoVFh6LHOrEGmiJKLnVT0KZ
2BSKtWfkDnpfP9CHNAlEnsy3mh1/YdE33Q8/OVjuMsgU8zhPzvOTa2oG0j8WCflj
bMkQWo2l0bEZmI0+LoOva9Qj2V61WKVntBaWWQIDAQABAoIBAEA3Wgxf27q3C+y6
9CfSDC23tWMVu947wpLJ98lUKWCtlS0aCf8kSe09ta4OqNmeAQwkc4VkdJKHb8yX
OXoi/KCxea4DSviFDGDM3cXlxr8GVTSDhsJbdITAwPNEhfn1jNhD7nrFenbIdTde
PD2yLC8wbl29FgMUWkiHP5Oj6dtB/l+uDdBFacPwsE7i6tJPz+CeuPFnHbmm0IcB
qZC3vKCkCDYG7NME70tdIJdRvJDxrHpnC3Uh2ZjHBgWhEifQp1pNax6O8gQqjUMd
43yjECNYHJnPp1PveiGOk656lh6B6zZgVcmWq+unuVBIIKWVH1oLJIlaCcjvGrIE
Ls9y8MECgYEA9uQu+xpJqoDbTEvryZwgPz8uQgJQq5YVarJknvPXpM37+LP/lfXW
Y5HBlUXq7arg4i1nPblcAM7RCYerG9nlheQNVf8uxfkDYVJM0uYWNU7u44jJ9xKF
3d0t6o5TAggwYftmASYmejEzG1QI8Ke4R/8O1UJJe5DPebtdmDVdi0cCgYEA1/HH
p1/5cAXsuGAWoEwfFdOwMBiQkKBtWiykwc/+muw4U5ulrz2mYH8LcD5EMkKvBnAN
JdjTg0ervwC9h8uiP84zZqsK/CE/MSSol7UD0n/le1YgJ4+8mqwjcI10MuNKx5zs
Akbh9ZmZUAOeN1xjZEH4nrdxr77Rq3x1Z9+WYV8CgYEA8TTloXWBWw8hMV1LM2FR
L/luHBde8QRkUCWRoKnimKSV89kHb18K4aRZWJlCeIhlxRNOtkMN28wy9fiR91fe
ofy3+rig3dH2t3JMlA8uy04enjXZ+4UhPC0G2w3Jk0ak3lVaxuya0u6WW7CyO0vh
ApXxy/BDEnHcAbZILpiUl6kCgYAxakWK2p6E8QYjhvGGiwTOBNwblXN3dQ6xBOhK
5aLYpteY4lQ+zrfE+y2N6OHIMpREv91yXLTCJON7WNsGOSYOvcvrYZao7Z69Sys9
VBHk2JmV6LaA9xZsupl9hxEhF/wjw5gKSVgp0JVRxxIsjvq7lZEkGMxuMBdgy6E+
PN73twKBgQDUZz5ZuANb2y/xq2Yg8h/GkeoagsS5a0GvUDtVPtN5+oTz13zUD340
tIx2TLC0RdTBRz8GXCaSHDH2iSEQAAnSh51o7IFEYeU/mMjSXVaux8JEJ9JKThit
Xrx6wkZxipg0Y9jImPSY86oHsKRfVb+zPoR5Frfxw3DbE7h+oUMc7w==
-----END RSA PRIVATE KEY-----
EOF
    chmod 0600 ~/.ssh/id_rsa
}

check_ntp(){
    yellow "\n\n===========================ntp已安装？=====================================\n"

    which ntpdate >/dev/null 2>&1
    if [ $? != 0 ]; then
        yellow "ntp install failed"
    else
        sudo ntpdate -u "$NTP_SERVER" >/dev/null 2>&1
        if [ $? != 0 ]; then
            red "ntpdate $NTP_SERVER failed"
        fi
        sudo mv /etc/ntp.conf /etc/ntp.conf.bk
        echo "server $NTP_SERVER iburst" | sudo tee /etc/ntp.conf > /dev/null
        sudo systemctl restart ntpd >/dev/null 2>&1
        if [ $? != 0 ]; then
            red "restart ntpd failed"
        fi

        sudo systemctl is-enabled ntpd >/dev/null 2>&1
        if [ $? != 0 ]; then
          sudo systemctl enable ntpd >/dev/null 2>&1
        fi
        sudo grep "ntpdate -u $NTP_SERVER" /etc/rc.d/rc.local >/dev/null 2>&1
        if [ $? != 0 ]; then
            echo "ntpdate -u $NTP_SERVER" | sudo tee -a /etc/rc.d/rc.local > /dev/null
        fi
        sudo chmod a+x /etc/rc.d/rc.local
    fi
}

check_node_exporter(){
    yellow "\n\n===========================node_exporter已安装？=====================================\n"

    which node_exporter >/dev/null 2>&1
    if [ $? != 0 ]; then
        sudo rpm -i "$STATIC_HOST/easyagent/dtstack-repos/node_exporter-0.15.2-1.el7.centos.x86_64.rpm"
        which node_exporter >/dev/null 2>&1
        if [ $? != 0 ]; then
           red "node_exporter install failed"
        fi
    else

        green "node_exporter success"
    fi

    sudo systemctl restart node_exporter >/dev/null 2>&1
    if [ $? != 0 ]; then
        red "restart node_exporter failed"
    fi

    sudo systemctl is-enabled node_exporter >/dev/null 2>&1
    if [ $? != 0 ]; then
      sudo systemctl enable node_exporter >/dev/null 2>&1
    fi
}

add_rc_local(){
   yellow "\n\n===========================ntp已安装？=====================================\n"

    sudo grep "cgroup.clone_children" /etc/rc.d/rc.local >/dev/null 2>&1
    if [ $? != 0 ]; then
        echo 1 | sudo tee /sys/fs/cgroup/cpu/cgroup.clone_children > /dev/null
        echo "echo 1 > /sys/fs/cgroup/cpu/cgroup.clone_children" | sudo tee -a /etc/rc.d/rc.local > /dev/null
    fi
    sudo chmod a+x /etc/rc.d/rc.local

}

check_data_dir
#check_User admin
installyum
check_umask
#check_iptables
check_firewalld
check_selinux
check_sysctl
#check_all_ping
check_limits
check_java
add_rc_local
check_pip_depends
check_ssh_nopwd
check_ntp
check_node_exporter

`)

func templatesEnvironmentInitShBytes() ([]byte, error) {
	return _templatesEnvironmentInitSh, nil
}

func templatesEnvironmentInitSh() (*asset, error) {
	bytes, err := templatesEnvironmentInitShBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/environment.init.sh", size: 12718, mode: os.FileMode(420), modTime: time.Unix(1638428450, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesHealthCheckSh = []byte(`#!/bin/bash

#usage ./port_status.sh localhost 80 8080 8088
#parameter 1 is host
#parameters after 1 are list of ports to check
#all ports are ok echo 1, else echo 0


if [ $# -lt 2 ] ; then
  echo "USAGE: $0 host [ports]"
  exit
fi

address=$1
ret=0
shift
i=$@


for i in "$@"; do
  if command -v nc >/dev/null 2>&1; then
 # echo "exists nc"
   #  echo  $address $i
     nc -w 10  $address $i  < /dev/null >/dev/null 2>&1

   #  echo status ======= $?
     if [ $? -eq 0 ] ; then
        ret=$(( $ret + 0 ))
     else
        ret=$(( $ret + 1 ))
     fi
  else
    ret=2
  fi
done


exit $ret
`)

func templatesHealthCheckShBytes() ([]byte, error) {
	return _templatesHealthCheckSh, nil
}

func templatesHealthCheckSh() (*asset, error) {
	bytes, err := templatesHealthCheckShBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/health-check.sh", size: 594, mode: os.FileMode(420), modTime: time.Unix(1638428450, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesImportClusterResourceV1beta1Yml = []byte(`apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: moles.operator.dtstack.com
spec:
  group: operator.dtstack.com
  names:
    kind: Mole
    listKind: MoleList
    plural: moles
    singular: mole
  scope: Namespaced
  validation:
    openAPIV3Schema:
      properties:
        apiVersion:
          type: string
        kind:
          type: string
        metadata:
          type: object
        spec:
          properties:
            product:
              properties:
                cluster_id:
                  type: integer
                deploy_uuid:
                  type: string
                imagePullSecret:
                  type: string
                parent_product_name:
                  type: string
                pid:
                  type: integer
                product_name:
                  type: string
                product_name_display:
                  type: string
                product_version:
                  type: string
                service:
                  additionalProperties:
                    properties:
                      base_attribute:
                        type: string
                      base_parsed:
                        type: boolean
                      base_product:
                        type: string
                      base_service:
                        type: string
                      depends_on:
                        items:
                          type: string
                        type: array
                      group:
                        type: string
                      instance:
                        properties:
                          cmd:
                            type: string
                          config_path:
                            items:
                              type: string
                            type: array
                          data_dir:
                            items:
                              type: string
                            type: array
                          deployment:
                            properties:
                              affinity:
                                properties:
                                  nodeAffinity:
                                    properties:
                                      preferredDuringSchedulingIgnoredDuringExecution:
                                        items:
                                          properties:
                                            preference:
                                              properties:
                                                matchExpressions:
                                                  items:
                                                    properties:
                                                      key:
                                                        type: string
                                                      operator:
                                                        type: string
                                                      values:
                                                        items:
                                                          type: string
                                                        type: array
                                                    required:
                                                      - key
                                                      - operator
                                                    type: object
                                                  type: array
                                                matchFields:
                                                  items:
                                                    properties:
                                                      key:
                                                        type: string
                                                      operator:
                                                        type: string
                                                      values:
                                                        items:
                                                          type: string
                                                        type: array
                                                    required:
                                                      - key
                                                      - operator
                                                    type: object
                                                  type: array
                                              type: object
                                            weight:
                                              format: int32
                                              type: integer
                                          required:
                                            - preference
                                            - weight
                                          type: object
                                        type: array
                                      requiredDuringSchedulingIgnoredDuringExecution:
                                        properties:
                                          nodeSelectorTerms:
                                            items:
                                              properties:
                                                matchExpressions:
                                                  items:
                                                    properties:
                                                      key:
                                                        type: string
                                                      operator:
                                                        type: string
                                                      values:
                                                        items:
                                                          type: string
                                                        type: array
                                                    required:
                                                      - key
                                                      - operator
                                                    type: object
                                                  type: array
                                                matchFields:
                                                  items:
                                                    properties:
                                                      key:
                                                        type: string
                                                      operator:
                                                        type: string
                                                      values:
                                                        items:
                                                          type: string
                                                        type: array
                                                    required:
                                                      - key
                                                      - operator
                                                    type: object
                                                  type: array
                                              type: object
                                            type: array
                                        required:
                                          - nodeSelectorTerms
                                        type: object
                                    type: object
                                  podAffinity:
                                    properties:
                                      preferredDuringSchedulingIgnoredDuringExecution:
                                        items:
                                          properties:
                                            podAffinityTerm:
                                              properties:
                                                labelSelector:
                                                  properties:
                                                    matchExpressions:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                    matchLabels:
                                                      additionalProperties:
                                                        type: string
                                                      type: object
                                                  type: object
                                                namespaces:
                                                  items:
                                                    type: string
                                                  type: array
                                                topologyKey:
                                                  type: string
                                              required:
                                                - topologyKey
                                              type: object
                                            weight:
                                              format: int32
                                              type: integer
                                          required:
                                            - podAffinityTerm
                                            - weight
                                          type: object
                                        type: array
                                      requiredDuringSchedulingIgnoredDuringExecution:
                                        items:
                                          properties:
                                            labelSelector:
                                              properties:
                                                matchExpressions:
                                                  items:
                                                    properties:
                                                      key:
                                                        type: string
                                                      operator:
                                                        type: string
                                                      values:
                                                        items:
                                                          type: string
                                                        type: array
                                                    required:
                                                      - key
                                                      - operator
                                                    type: object
                                                  type: array
                                                matchLabels:
                                                  additionalProperties:
                                                    type: string
                                                  type: object
                                              type: object
                                            namespaces:
                                              items:
                                                type: string
                                              type: array
                                            topologyKey:
                                              type: string
                                          required:
                                            - topologyKey
                                          type: object
                                        type: array
                                    type: object
                                  podAntiAffinity:
                                    properties:
                                      preferredDuringSchedulingIgnoredDuringExecution:
                                        items:
                                          properties:
                                            podAffinityTerm:
                                              properties:
                                                labelSelector:
                                                  properties:
                                                    matchExpressions:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                    matchLabels:
                                                      additionalProperties:
                                                        type: string
                                                      type: object
                                                  type: object
                                                namespaces:
                                                  items:
                                                    type: string
                                                  type: array
                                                topologyKey:
                                                  type: string
                                              required:
                                                - topologyKey
                                              type: object
                                            weight:
                                              format: int32
                                              type: integer
                                          required:
                                            - podAffinityTerm
                                            - weight
                                          type: object
                                        type: array
                                      requiredDuringSchedulingIgnoredDuringExecution:
                                        items:
                                          properties:
                                            labelSelector:
                                              properties:
                                                matchExpressions:
                                                  items:
                                                    properties:
                                                      key:
                                                        type: string
                                                      operator:
                                                        type: string
                                                      values:
                                                        items:
                                                          type: string
                                                        type: array
                                                    required:
                                                      - key
                                                      - operator
                                                    type: object
                                                  type: array
                                                matchLabels:
                                                  additionalProperties:
                                                    type: string
                                                  type: object
                                              type: object
                                            namespaces:
                                              items:
                                                type: string
                                              type: array
                                            topologyKey:
                                              type: string
                                          required:
                                            - topologyKey
                                          type: object
                                        type: array
                                    type: object
                                type: object
                              annotations:
                                additionalProperties:
                                  type: string
                                type: object
                              containers:
                                items:
                                  properties:
                                    image:
                                      type: string
                                    name:
                                      type: string
                                  type: object
                                type: array
                              image:
                                type: string
                              labels:
                                additionalProperties:
                                  type: string
                                type: object
                              nodeSelector:
                                additionalProperties:
                                  type: string
                                type: object
                              ports:
                                items:
                                  type: integer
                                type: array
                              replicas:
                                format: int32
                                type: integer
                              resources:
                                properties:
                                  limits:
                                    additionalProperties:
                                      anyOf:
                                        - type: integer
                                        - type: string
                                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                      x-kubernetes-int-or-string: true
                                    type: object
                                  requests:
                                    additionalProperties:
                                      anyOf:
                                        - type: integer
                                        - type: string
                                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                      x-kubernetes-int-or-string: true
                                    type: object
                                type: object
                              securityContext:
                                properties:
                                  fsGroup:
                                    format: int64
                                    type: integer
                                  fsGroupChangePolicy:
                                    type: string
                                  runAsGroup:
                                    format: int64
                                    type: integer
                                  runAsNonRoot:
                                    type: boolean
                                  runAsUser:
                                    format: int64
                                    type: integer
                                  seLinuxOptions:
                                    properties:
                                      level:
                                        type: string
                                      role:
                                        type: string
                                      type:
                                        type: string
                                      user:
                                        type: string
                                    type: object
                                  supplementalGroups:
                                    items:
                                      format: int64
                                      type: integer
                                    type: array
                                  sysctls:
                                    items:
                                      properties:
                                        name:
                                          type: string
                                        value:
                                          type: string
                                      required:
                                        - name
                                        - value
                                      type: object
                                    type: array
                                  windowsOptions:
                                    properties:
                                      gmsaCredentialSpec:
                                        type: string
                                      gmsaCredentialSpecName:
                                        type: string
                                      runAsUserName:
                                        type: string
                                    type: object
                                type: object
                              terminationGracePeriodSeconds:
                                format: int64
                                type: integer
                              tolerations:
                                items:
                                  properties:
                                    effect:
                                      type: string
                                    key:
                                      type: string
                                    operator:
                                      type: string
                                    tolerationSeconds:
                                      format: int64
                                      type: integer
                                    value:
                                      type: string
                                  type: object
                                type: array
                            type: object
                          environment:
                            additionalProperties:
                              type: string
                            type: object
                          ingress:
                            properties:
                              annotations:
                                additionalProperties:
                                  type: string
                                type: object
                              enabled:
                                type: boolean
                              hostname:
                                type: string
                              labels:
                                additionalProperties:
                                  type: string
                                type: object
                              path:
                                type: string
                              targetPort:
                                type: string
                              tlsEnabled:
                                type: boolean
                              tlsSecretName:
                                type: string
                            type: object
                          logs:
                            items:
                              type: string
                            type: array
                          post_deploy:
                            type: string
                          prometheus_port:
                            type: string
                          resources:
                            properties:
                              limits:
                                additionalProperties:
                                  anyOf:
                                    - type: integer
                                    - type: string
                                  pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                  x-kubernetes-int-or-string: true
                                type: object
                              requests:
                                additionalProperties:
                                  anyOf:
                                    - type: integer
                                    - type: string
                                  pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                  x-kubernetes-int-or-string: true
                                type: object
                            type: object
                          service:
                            properties:
                              annotations:
                                additionalProperties:
                                  type: string
                                type: object
                              labels:
                                additionalProperties:
                                  type: string
                                type: object
                              ports:
                                items:
                                  properties:
                                    appProtocol:
                                      type: string
                                    name:
                                      type: string
                                    nodePort:
                                      format: int32
                                      type: integer
                                    port:
                                      format: int32
                                      type: integer
                                    protocol:
                                      type: string
                                    targetPort:
                                      anyOf:
                                        - type: integer
                                        - type: string
                                      x-kubernetes-int-or-string: true
                                  required:
                                    - port
                                  type: object
                                type: array
                              type:
                                type: string
                            type: object
                        type: object
                      is_deploy_ingress:
                        type: boolean
                      is_job:
                        type: boolean
                      service_display:
                        type: string
                      version:
                        type: string
                    type: object
                  type: object
              required:
                - service
              type: object
          type: object
        status:
          properties:
            message:
              type: string
            phase:
              type: string
          required:
            - message
            - phase
          type: object
      type: object
  version: v1
  versions:
    - name: v1
      served: true
      storage: true
`)

func templatesImportClusterResourceV1beta1YmlBytes() ([]byte, error) {
	return _templatesImportClusterResourceV1beta1Yml, nil
}

func templatesImportClusterResourceV1beta1Yml() (*asset, error) {
	bytes, err := templatesImportClusterResourceV1beta1YmlBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/import-cluster-resource-v1beta1.yml", size: 29601, mode: os.FileMode(420), modTime: time.Unix(1638428450, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesImportClusterResourceYml = []byte(`apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: moles.operator.dtstack.com
spec:
  group: operator.dtstack.com
  names:
    kind: Mole
    listKind: MoleList
    plural: moles
    singular: mole
  scope: Namespaced
  versions:
    - name: v1
      schema:
        openAPIV3Schema:
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              properties:
                product:
                  properties:
                    cluster_id:
                      type: integer
                    deploy_uuid:
                      type: string
                    imagePullSecret:
                      type: string
                    parent_product_name:
                      type: string
                    pid:
                      type: integer
                    product_name:
                      type: string
                    product_name_display:
                      type: string
                    product_version:
                      type: string
                    service:
                      additionalProperties:
                        properties:
                          base_attribute:
                            type: string
                          base_parsed:
                            type: boolean
                          base_product:
                            type: string
                          base_service:
                            type: string
                          depends_on:
                            items:
                              type: string
                            type: array
                          group:
                            type: string
                          instance:
                            properties:
                              cmd:
                                type: string
                              config_path:
                                items:
                                  type: string
                                type: array
                              data_dir:
                                items:
                                  type: string
                                type: array
                              deployment:
                                properties:
                                  affinity:
                                    properties:
                                      nodeAffinity:
                                        properties:
                                          preferredDuringSchedulingIgnoredDuringExecution:
                                            items:
                                              properties:
                                                preference:
                                                  properties:
                                                    matchExpressions:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                    matchFields:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                  type: object
                                                weight:
                                                  format: int32
                                                  type: integer
                                              required:
                                                - preference
                                                - weight
                                              type: object
                                            type: array
                                          requiredDuringSchedulingIgnoredDuringExecution:
                                            properties:
                                              nodeSelectorTerms:
                                                items:
                                                  properties:
                                                    matchExpressions:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                    matchFields:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                  type: object
                                                type: array
                                            required:
                                              - nodeSelectorTerms
                                            type: object
                                        type: object
                                      podAffinity:
                                        properties:
                                          preferredDuringSchedulingIgnoredDuringExecution:
                                            items:
                                              properties:
                                                podAffinityTerm:
                                                  properties:
                                                    labelSelector:
                                                      properties:
                                                        matchExpressions:
                                                          items:
                                                            properties:
                                                              key:
                                                                type: string
                                                              operator:
                                                                type: string
                                                              values:
                                                                items:
                                                                  type: string
                                                                type: array
                                                            required:
                                                              - key
                                                              - operator
                                                            type: object
                                                          type: array
                                                        matchLabels:
                                                          additionalProperties:
                                                            type: string
                                                          type: object
                                                      type: object
                                                    namespaces:
                                                      items:
                                                        type: string
                                                      type: array
                                                    topologyKey:
                                                      type: string
                                                  required:
                                                    - topologyKey
                                                  type: object
                                                weight:
                                                  format: int32
                                                  type: integer
                                              required:
                                                - podAffinityTerm
                                                - weight
                                              type: object
                                            type: array
                                          requiredDuringSchedulingIgnoredDuringExecution:
                                            items:
                                              properties:
                                                labelSelector:
                                                  properties:
                                                    matchExpressions:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                    matchLabels:
                                                      additionalProperties:
                                                        type: string
                                                      type: object
                                                  type: object
                                                namespaces:
                                                  items:
                                                    type: string
                                                  type: array
                                                topologyKey:
                                                  type: string
                                              required:
                                                - topologyKey
                                              type: object
                                            type: array
                                        type: object
                                      podAntiAffinity:
                                        properties:
                                          preferredDuringSchedulingIgnoredDuringExecution:
                                            items:
                                              properties:
                                                podAffinityTerm:
                                                  properties:
                                                    labelSelector:
                                                      properties:
                                                        matchExpressions:
                                                          items:
                                                            properties:
                                                              key:
                                                                type: string
                                                              operator:
                                                                type: string
                                                              values:
                                                                items:
                                                                  type: string
                                                                type: array
                                                            required:
                                                              - key
                                                              - operator
                                                            type: object
                                                          type: array
                                                        matchLabels:
                                                          additionalProperties:
                                                            type: string
                                                          type: object
                                                      type: object
                                                    namespaces:
                                                      items:
                                                        type: string
                                                      type: array
                                                    topologyKey:
                                                      type: string
                                                  required:
                                                    - topologyKey
                                                  type: object
                                                weight:
                                                  format: int32
                                                  type: integer
                                              required:
                                                - podAffinityTerm
                                                - weight
                                              type: object
                                            type: array
                                          requiredDuringSchedulingIgnoredDuringExecution:
                                            items:
                                              properties:
                                                labelSelector:
                                                  properties:
                                                    matchExpressions:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                    matchLabels:
                                                      additionalProperties:
                                                        type: string
                                                      type: object
                                                  type: object
                                                namespaces:
                                                  items:
                                                    type: string
                                                  type: array
                                                topologyKey:
                                                  type: string
                                              required:
                                                - topologyKey
                                              type: object
                                            type: array
                                        type: object
                                    type: object
                                  annotations:
                                    additionalProperties:
                                      type: string
                                    type: object
                                  containers:
                                    items:
                                      properties:
                                        image:
                                          type: string
                                        name:
                                          type: string
                                      type: object
                                    type: array
                                  image:
                                    type: string
                                  labels:
                                    additionalProperties:
                                      type: string
                                    type: object
                                  nodeSelector:
                                    additionalProperties:
                                      type: string
                                    type: object
                                  ports:
                                    items:
                                      type: integer
                                    type: array
                                  replicas:
                                    format: int32
                                    type: integer
                                  resources:
                                    properties:
                                      limits:
                                        additionalProperties:
                                          anyOf:
                                            - type: integer
                                            - type: string
                                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                          x-kubernetes-int-or-string: true
                                        type: object
                                      requests:
                                        additionalProperties:
                                          anyOf:
                                            - type: integer
                                            - type: string
                                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                          x-kubernetes-int-or-string: true
                                        type: object
                                    type: object
                                  securityContext:
                                    properties:
                                      fsGroup:
                                        format: int64
                                        type: integer
                                      fsGroupChangePolicy:
                                        type: string
                                      runAsGroup:
                                        format: int64
                                        type: integer
                                      runAsNonRoot:
                                        type: boolean
                                      runAsUser:
                                        format: int64
                                        type: integer
                                      seLinuxOptions:
                                        properties:
                                          level:
                                            type: string
                                          role:
                                            type: string
                                          type:
                                            type: string
                                          user:
                                            type: string
                                        type: object
                                      supplementalGroups:
                                        items:
                                          format: int64
                                          type: integer
                                        type: array
                                      sysctls:
                                        items:
                                          properties:
                                            name:
                                              type: string
                                            value:
                                              type: string
                                          required:
                                            - name
                                            - value
                                          type: object
                                        type: array
                                      windowsOptions:
                                        properties:
                                          gmsaCredentialSpec:
                                            type: string
                                          gmsaCredentialSpecName:
                                            type: string
                                          runAsUserName:
                                            type: string
                                        type: object
                                    type: object
                                  terminationGracePeriodSeconds:
                                    format: int64
                                    type: integer
                                  tolerations:
                                    items:
                                      properties:
                                        effect:
                                          type: string
                                        key:
                                          type: string
                                        operator:
                                          type: string
                                        tolerationSeconds:
                                          format: int64
                                          type: integer
                                        value:
                                          type: string
                                      type: object
                                    type: array
                                type: object
                              environment:
                                additionalProperties:
                                  type: string
                                type: object
                              ingress:
                                properties:
                                  annotations:
                                    additionalProperties:
                                      type: string
                                    type: object
                                  enabled:
                                    type: boolean
                                  hostname:
                                    type: string
                                  labels:
                                    additionalProperties:
                                      type: string
                                    type: object
                                  path:
                                    type: string
                                  targetPort:
                                    type: string
                                  tlsEnabled:
                                    type: boolean
                                  tlsSecretName:
                                    type: string
                                type: object
                              logs:
                                items:
                                  type: string
                                type: array
                              post_deploy:
                                type: string
                              prometheus_port:
                                type: string
                              resources:
                                properties:
                                  limits:
                                    additionalProperties:
                                      anyOf:
                                        - type: integer
                                        - type: string
                                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                      x-kubernetes-int-or-string: true
                                    type: object
                                  requests:
                                    additionalProperties:
                                      anyOf:
                                        - type: integer
                                        - type: string
                                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                      x-kubernetes-int-or-string: true
                                    type: object
                                type: object
                              service:
                                properties:
                                  annotations:
                                    additionalProperties:
                                      type: string
                                    type: object
                                  labels:
                                    additionalProperties:
                                      type: string
                                    type: object
                                  ports:
                                    items:
                                      properties:
                                        appProtocol:
                                          type: string
                                        name:
                                          type: string
                                        nodePort:
                                          format: int32
                                          type: integer
                                        port:
                                          format: int32
                                          type: integer
                                        protocol:
                                          type: string
                                        targetPort:
                                          anyOf:
                                            - type: integer
                                            - type: string
                                          x-kubernetes-int-or-string: true
                                      required:
                                        - port
                                      type: object
                                    type: array
                                  type:
                                    type: string
                                type: object
                            type: object
                          is_deploy_ingress:
                            type: boolean
                          is_job:
                            type: boolean
                          service_display:
                            type: string
                          version:
                            type: string
                        type: object
                      type: object
                  required:
                    - service
                  type: object
              type: object
            status:
              properties:
                message:
                  type: string
                phase:
                  type: string
              required:
                - message
                - phase
              type: object
          type: object
      served: true
      storage: true


---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: (devel)
  creationTimestamp: null
  name: workloads.dtstack.com
spec:
  group: dtstack.com
  names:
    kind: WorkLoad
    listKind: WorkLoadList
    plural: workloads
    singular: workload
  scope: Namespaced
  versions:
    - name: v1beta1
      schema:
        openAPIV3Schema:
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              properties:
                workloadpatrs:
                  items:
                    properties:
                      baseworkload:
                        properties:
                          name:
                            type: string
                          parameters:
                            x-kubernetes-preserve-unknown-fields: true
                            type: object
                          type:
                            type: string
                        required:
                          - name
                          - type
                        type: object
                      steps:
                        items:
                          properties:
                            action:
                              type: string
                            name:
                              type: string
                            object:
                              x-kubernetes-preserve-unknown-fields: true
                              type: object
                            type:
                              type: string
                          required:
                            - action
                            - name
                            - object
                            - type
                          type: object
                        type: array
                    required:
                      - baseworkload
                    type: object
                  type: array
              type: object
            status:
              properties:
                part_status:
                  additionalProperties:
                    properties:
                      message:
                        type: string
                      status:
                        type: string
                    required:
                      - message
                      - status
                    type: object
                  type: object
                phase:
                  type: string
              required:
                - phase
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []


---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: (devel)
  creationTimestamp: null
  name: workloadprocess.dtstack.com
spec:
  group: dtstack.com
  names:
    kind: WorkloadProcess
    listKind: WorkloadProcessList
    plural: workloadprocess
    singular: workloadprocess
  scope: Namespaced
  versions:
    - name: v1beta1
      schema:
        openAPIV3Schema:
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              properties:
                cluster_id:
                  type: integer
                deploy_id:
                  type: string
                last_deploy_id:
                  type: string
                parent_product_name:
                  type: string
                product_id:
                  type: integer
                product_name:
                  type: string
                product_version:
                  type: string
                work_loads:
                  additionalProperties:
                    properties:
                      group:
                        type: string
                      version:
                        type: string
                      workload:
                        properties:
                          apiVersion:
                            type: string
                          kind:
                            type: string
                          metadata:
                            x-kubernetes-preserve-unknown-fields: true
                            type: object
                          spec:
                            properties:
                              workloadpatrs:
                                items:
                                  properties:
                                    baseworkload:
                                      properties:
                                        name:
                                          type: string
                                        parameters:
                                          x-kubernetes-preserve-unknown-fields: true
                                          type: object
                                        type:
                                          type: string
                                      required:
                                        - name
                                        - type
                                      type: object
                                    steps:
                                      items:
                                        properties:
                                          action:
                                            type: string
                                          name:
                                            type: string
                                          object:
                                            x-kubernetes-preserve-unknown-fields: true
                                            type: object
                                          type:
                                            type: string
                                        required:
                                          - action
                                          - name
                                          - object
                                          - type
                                        type: object
                                      type: array
                                  required:
                                    - baseworkload
                                  type: object
                                type: array
                            type: object
                          status:
                            properties:
                              part_status:
                                additionalProperties:
                                  properties:
                                    message:
                                      type: string
                                    status:
                                      type: string
                                  required:
                                    - message
                                    - status
                                  type: object
                                type: object
                              phase:
                                type: string
                            required:
                              - phase
                            type: object
                        type: object
                    required:
                      - group
                      - version
                      - workload
                    type: object
                  type: object
              required:
                - cluster_id
                - deploy_id
                - last_deploy_id
                - product_id
                - product_name
              type: object
            status:
              properties:
                phase:
                  type: string
              type: object
          required:
            - spec
          type: object
      served: true
      storage: true
      subresources:
        status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
`)

func templatesImportClusterResourceYmlBytes() ([]byte, error) {
	return _templatesImportClusterResourceYml, nil
}

func templatesImportClusterResourceYml() (*asset, error) {
	bytes, err := templatesImportClusterResourceYmlBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/import-cluster-resource.yml", size: 40146, mode: os.FileMode(420), modTime: time.Unix(1638428450, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesImportNsResouceYml = []byte(`---
apiVersion: v1
data:
  .dockerconfigjson: {{.IMAGE_SECRET}}
kind: Secret
metadata:
  name: dtstack
  namespace: {{.NAME_SPACE}}
type: kubernetes.io/dockerconfigjson

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: easyagent
  namespace: {{.NAME_SPACE}}
  labels:
    k8s-app: easyagent
    kubernetes.io/cluster-service: "true"
spec:
  selector:
    matchLabels:
      app: easyagent
  template:
    metadata:
      labels:
        app: easyagent
    spec:
      imagePullSecrets:
        - name: dtstack
      containers:
        - name: easyagent
          image: {{.REGISTRY}}easykubeagent:1.0
          imagePullPolicy: Always
          ports:
            - containerPort: 8899
          resources:
            limits:
              memory: 512Mi
              cpu: 500m
          env:
            - name: OPERATOR_NAMESPACE
              value: {{.NAME_SPACE}}
            - name: OPERATOR_REGISTRY
              value: {{.REGISTRY}}
            - name: OPERATOR_SECRET
              value: dtstack
            - name: WATCH_NAMESPACE
              value: {{.NAME_SPACE}}

---

apiVersion: v1
kind: Service
metadata:
  name: easyagent
  namespace: {{.NAME_SPACE}}
  labels:
    app: easyagent
spec:
  selector:
    app: easyagent
  ports:
    - name: http
      port: 8899
      protocol: TCP
`)

func templatesImportNsResouceYmlBytes() ([]byte, error) {
	return _templatesImportNsResouceYml, nil
}

func templatesImportNsResouceYml() (*asset, error) {
	bytes, err := templatesImportNsResouceYmlBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/import-ns-resouce.yml", size: 1314, mode: os.FileMode(420), modTime: time.Unix(1638428450, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesInstallAgentxSh = []byte(`#!/bin/bash
set -ex

############################
#Copyright (c) 2017 DTStack Inc.
#Version  0.1
############################

agent_zip='{{.AGENT_ZIP}}'

#此参数值被程序使用，修改时请@huanxiong
app_dir='{{.AGENT_DIR}}'
agent_bin='{{.AGENT_BIN}}'
run_user='{{.RUN_USER}}'
data_dir='{{.DATA_DIR}}'
unzip_tmp_dir='/opt/dtstack/tmp'

#安装包下载地址
DOWNLOAD_URL='{{.AGENT_DOWNLOAD_URL}}'

trap '[ "$?" -eq 0 ] || read -p "Looks like something went wrong in step ´$STEP´"' EXIT

##install the filebeat##
install_agent() {
    mkdir -p "$app_dir"
    unzip -o "$unzip_tmp_dir/$agent_zip" -d "$app_dir"  >/dev/null 2>&1
}

##download and installed##
install(){
    STEP='install agent'
    echo "Use the curl download and install Please Waiting..."
    if [ ! -d "$unzip_tmp_dir" ];then
        sudo mkdir -p $unzip_tmp_dir
    fi
    cd "$unzip_tmp_dir" && sudo curl -L -O -s "$DOWNLOAD_URL"
    install_agent

    if [ ! -f "$agent_bin" ];then
        echo "cmd: $agent_bin not found!"
        exit 1
    fi
}

##chown##
chowns(){
    STEP='chown'
    if [ -n "$run_user" ];then
        sudo chown -R "$run_user:$run_user" "$app_dir"
        if [ -n "$data_dir" ];then
            for path in ` + "`" + `echo $data_dir` + "`" + `
            do
                sudo mkdir -p $path
                sudo chown -R "$run_user:$run_user" $path
            done
        fi
    else
        if [ -n "$data_dir" ];then
            for path in ` + "`" + `echo $data_dir` + "`" + `
            do
                sudo mkdir -p $path
            done
        fi
    fi
}

##delete filebeat pkg##
delete(){
    STEP='delete'
    cd "$unzip_tmp_dir" && sudo rm -f "$agent_zip"
}

install
chowns
delete
`)

func templatesInstallAgentxShBytes() ([]byte, error) {
	return _templatesInstallAgentxSh, nil
}

func templatesInstallAgentxSh() (*asset, error) {
	bytes, err := templatesInstallAgentxShBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/install.agentx.sh", size: 1669, mode: os.FileMode(420), modTime: time.Unix(1651215709, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesInstallScriptWrapperSh = []byte(`#!/bin/sh
set -ex

############################
#Copyright (c) 2017 DTStack Inc.
#Version  0.1
############################
INSTALL_PATH='{{.INSTALL_PATH}}'

script_wrapper_app='script_wrapper.tar.gz'
app_dir='/opt/dtstack/easyagent'

if [ -n "${INSTALL_PATH}" ];then
    app_dir="${INSTALL_PATH}"
else
    INSTALL_PATH="$app_dir"
fi

agent_bin="$app_dir/script_wrapper/script-wrapper"

#安装包下载地址
DOWNLOAD_URL='http://{{.EASYAGENT_SERVER}}/easyagent/script_wrapper.tar.gz'

set -e
trap '[ "$?" -eq 0 ] || read -p "Looks like something went wrong in step ´$STEP´"' EXIT

##install the script-wrapper##
install_script_wrapper() {
    STEP='install_script_wrapper'
    mkdir -p "$app_dir"
    tar -zxf "/tmp/$script_wrapper_app" -C "$app_dir"  >/dev/null 2>&1

     if [ -f "$agent_bin" ];then
         echo -e "...The script_wrapper install...  \033[34;1m[Success]\033[0m"
     else
         echo -e "...The script_wrapper install...  \033[31;1m[Failed]\033[0m"
         exit 1
     fi
}

##download and installed##
install(){
    STEP='install'
    echo -e " Use the curl download and install,\033[32;1m Please Waiting...\033[0m"
    cd /tmp/ && curl -L -O -s "$DOWNLOAD_URL"
    install_script_wrapper

    if [ ! -f "$agent_bin" ];then
        echo -e "\033[31;1mThe script_wrapper is faile to install....\033[0m"
        exit 1
    fi
}

##delete $script_wrapper pakg##
delete(){
    STEP='delete'
    cd /tmp/ && rm -f "$script_wrapper_app"
}

install
delete
`)

func templatesInstallScriptWrapperShBytes() ([]byte, error) {
	return _templatesInstallScriptWrapperSh, nil
}

func templatesInstallScriptWrapperSh() (*asset, error) {
	bytes, err := templatesInstallScriptWrapperShBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/install.script.wrapper.sh", size: 1477, mode: os.FileMode(420), modTime: time.Unix(1638428450, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesListFilesSh = []byte(`#!/bin/sh

current=` + "`" + `date "+%Y-%m-%d %H:%M:%S"` + "`" + `
timeStamp=` + "`" + `date -d "$current" +%s` + "`" + `

tmp="/tmp/heapdumps_{SERVICENAME}_$timeStamp"

find -L /opt/dtstack/{PRODUCTNAME}/{SERVICENAME}/*/heapdump.hprof -maxdepth 5 -size -4096M -type f -mmin -5 -print > $tmp 2>/dev/null

if [ -f "$tmp" ];then
for i in ` + "`" + `cat $tmp` + "`" + `
do
echo '{"file_name":{"desc":"JavaHeapDump文件名称","value":"'$i'"},"product_name":{"desc":"所属组件","value":"{PRODUCTNAME}"},"service_name":{"desc":"服务名称","value":"{SERVICENAME}"},"host":{"desc":"主机IP","value":"{HOSTIP}"},"generate_time":{"desc":"生成时间","value":"'$current'"},"action":{"desc":"操作","value":"下载","instance":"{INSTANCEID}","path":"'$i'"}}'
break
done
fi

rm -f $tmp
`)

func templatesListFilesShBytes() ([]byte, error) {
	return _templatesListFilesSh, nil
}

func templatesListFilesSh() (*asset, error) {
	bytes, err := templatesListFilesShBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/list-files.sh", size: 725, mode: os.FileMode(420), modTime: time.Unix(1638428450, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesNetCheckSh = []byte(`#!/bin/sh

#usage ./en-check.sh emip 8889 8890
#parameter 1 is em host
#parameters after 1 are list of ports to check

if [ $# -lt 2 ] ; then
  echo "USAGE: $0 em-host [ports]"
  exit
fi

red(){
    CONTENT=$1
    echo -e "\033[31m${CONTENT}\033[0m"
    exit 1
}

green(){
    CONTENT=$1
    echo -e "\033[32m${CONTENT}\033[0m"
}

yellow(){
    CONTENT=$1
    echo -e "\033[33m${CONTENT}\033[0m"
}

em_host=$1
shift
i=$@

for i in "$@"; do
    if command -v nc >/dev/null 2>&1; then
        nc -w 10  $em_host $i  < /dev/null >/dev/null 2>&1
        if [ $? -eq 0 ] ; then
            green "to em $i is ok!"
        else
            red "to em $i is not ok!"
        fi
    else
        red "command nc is not installed!"
    fi
done


check_iptables(){
    yellow "\n\n===========================iptabls已关闭？=====================================\n"
    sudo service iptables status >/dev/null 2>&1
    exit_status=$?
    if [ $exit_status -ne 0 ]; then
        green "iptables is closed"
    else
        red "iptables is not closed"
    fi
}

check_firewalld(){
    yellow "\n\n===========================firewalld已关闭？=====================================\n"
    sudo systemctl is-enabled firewalld >/dev/null 2>&1
    if [ $? == 0 ]; then
        red "firewalld is not closed"
    else
        green "firewalld is closed"
    fi
}

check_selinux(){
    yellow "\n\n===========================selinux已关闭？=====================================\n"
    sudo /usr/sbin/getenforce | grep -E "disabled|ermissive" >/dev/null 2>&1
    exit_status=$?
    if [ $exit_status -eq 0 ]; then
      green "selinux is disabled"
    else
      red "selinux is not closed"
    fi

}

check_to_em(){
    yellow "\n\n===========================to em host network ok？=====================================\n"
    for i in "$@"; do
        if command -v nc >/dev/null 2>&1; then
            nc -w 10  $em_host $i  < /dev/null >/dev/null 2>&1
            if [ $? -eq 0 ] ; then
                green "to em $i is ok!"
            else
                red "to em $i is not ok!"
            fi
        else
            red "command nc is not installed!"
        fi
    done
    green "to em host network is ok"
}

check_to_em
check_iptables
check_firewalld
check_selinux
`)

func templatesNetCheckShBytes() ([]byte, error) {
	return _templatesNetCheckSh, nil
}

func templatesNetCheckSh() (*asset, error) {
	bytes, err := templatesNetCheckShBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/net-check.sh", size: 2272, mode: os.FileMode(420), modTime: time.Unix(1638428450, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesPatchupdateSh = []byte(`#!/bin/bash
set -ex

############################
#Copyright (c) 2017 DTStack Inc.
#Version  0.1git
############################
##如：/opt/dtstack/DTBase/redis/bin/abc.jar
patch_path='{{.PATCHES_PATH}}'

#此参数值被程序使用，修改时请@huanxiong
#如：/opt/dtstack/DTBase/redis
app_dir='{{.AGENT_DIR}}'

#安装包下载地址
#(http://172.16.8.87:8864/easyagent/DTBase/2.0.9/redis/patches_package/abc.jar)
DOWNLOAD_URL='{{.AGENT_DOWNLOAD_URL}}'

trap '[ "$?" -eq 0 ] || read -p "Looks like something went wrong in step ´$STEP´"' EXIT

##判断备份目录是否存在
backup_dir(){
  STEP='create backup dir'
  if [ ! -d ${app_dir}/patch_backup ]
  then
      mkdir -p ${app_dir}/patch_backup
  fi
}

##下载补丁包
download_patch(){
    STEP='download patch'
    echo "Use the curl download and replace Please Waiting..."
    package_name=${patch_path##*/}
    cp ${patch_path} ${app_dir}/patch_backup/${package_name}.$(date +%s)
    cd /tmp/ && curl -L -O -s "$DOWNLOAD_URL"
    \mv /tmp/${DOWNLOAD_URL##*/} ${patch_path}
}

backup_dir
download_patch
`)

func templatesPatchupdateShBytes() ([]byte, error) {
	return _templatesPatchupdateSh, nil
}

func templatesPatchupdateSh() (*asset, error) {
	bytes, err := templatesPatchupdateShBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/patchupdate.sh", size: 1075, mode: os.FileMode(420), modTime: time.Unix(1638428450, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesRolePermissionsYml = []byte(`# 1: Administrator, 3: Cluster Operator, 7: Cluster Reader

---
permissions:
  - title: 运维中心
    code: 'menu_ops_center'
    permission: 7
    children:
      - title: 概览
        code: 'sub_menu_overview'
        permission: 7
      - title: 服务
        code: 'sub_menu_service'
        permission: 7
        children:
          - title: 服务查看
            code: 'service_view'
            permission: 7
            children: []
          - title: 组件启停
            code: 'service_product_start_stop'
            permission: 3
            children: []
          - title: 服务启停
            code: 'service_start_stop'
            permission: 3
            children: []
          - title: 服务滚动重启
            code: 'service_roll_restart'
            permission: 3
            children: []
          - title: 服务扩缩容
            code: 'service_replica'
            permission: 3
            children: []
          - title: 参数编辑
            code: 'service_config_edit'
            permission: 3
            children: []
          - title: 重置参数
            code: 'reset_service_config_edit'
            permission: 1
            children: []
          - title: 配置下发
            code: 'service_config_distribute'
            permission: 1
            children: []
          - title: 仪表盘查看
            code: 'service_dashboard_view'
            permission: 7
            children: []
          - title: 配置主机关联
            code: 'sub_menu_scheme_host_associated'
            permission: 1
            children: []
          - title: 密码锁
            code: 'sub_menu_scheme_password_lock'
            permission: 1
            children: []
      - title: 主机
        code: 'sub_menu_host'
        permission: 7
      - title: 诊断
        code: 'sub_menu_diagnose'
        permission: 7
        children:
          - title: 日志查看
            code: 'sub_menu_diagnose_log'
            permission: 7
            children:
              - title: 日志查看
                code: 'log_view'
                permission: 7
                children: []
              - title: 日志下载
                code: 'log_download'
                permission: 7
                children: []
          - title: 事件诊断
            code: 'sub_menu_diagnose_event'
            permission: 7
            children: []
          - title: 配置变更
            code: 'sub_menu_diagnose_config_change'
            permission: 7
            children: []
          - title: 巡检报告
            code: 'sub_menu_diagnose_inspect_report'
            permission: 1
            children: []
          - title: 备份管理
            code: 'sub_menu_diagnose_backup'
            permission: 7
            children:
              - title: 备份删除
                code: 'sub_menu_backup_manage_delete'
                permission: 3
                children: []
  - title: 部署中心
    code: 'menu_deploy_center'
    permission: 7
    children:
      - title: 集群管理
        code: 'sub_menu_cluster_manage'
        permission: 7
        children:
          - title: 集群列表
            code: 'sub_menu_cluster_list'
            permission: 7
            children:
              - title: 集群详情
                code: 'sub_menu_detail'
                permission: 7
                children:
                  - title: 总览
                    code: 'sub_menu_detail_overview'
                    permission: 7
                    children:
                      - title: 查看
                        code: 'cluster_view'
                        permission: 7
                        children: []
                  - title: 主机资源
                    code: 'sub_menu_detail_host'
                    permission: 7
                    children:
                      - title: 编辑主机角色
                        code: 'sub_menu_host_role_manage'
                        permission: 3
                        children: []
                  - title: 镜像仓库
                    code: 'sub_menu_detail_image_store'
                    permission: 7
                    children:
                      - title: 查看
                        code: 'image_store_view'
                        permission: 7
                        children: []
                      - title: 编辑
                        code: 'image_store_edit'
                        permission: 3
                        children: []
                  - title: 命名空间
                    code: 'sub_menu_detail_namespace'
                    permission: 7
                    children:
                      - title: 查看
                        code: ns_view
                        permission: 7
                        children: []
                      - title: 编辑
                        code: 'ns_edit'
                        permission: 3
                        children: []
                      - title: yaml编辑
                        code: 'yaml_edit'
                        permission: 1
                        children: []
                  - title: 已部署组件
                    code: 'sub_menu_detail_deployed'
                    permission: 7
                    children:
                      - title: 查看
                        code: 'installed_app_view'
                        permission: 7
                        children: []
                      - title: 产品包升级
                        code: 'package_upgrade'
                        permission: 3
                        children: []
                  - title: 部署历史
                    code: 'sub_menu_detail_history'
                    permission: 7
                    children: []
                  - title: 补丁包
                    code: 'sub_menu_detail_patch'
                    permission: 3
                    children: []
                  - title: 集群命令
                    code: 'sub_menu_detail_order'
                    permission: 3
                    children: []
                  - title: 产品包下载
                    code: 'package_download'
                    permission: 3
                    children: []
                  - title: 补丁包更新
                    code: 'patches_update'
                    permission: 3
                    children: []
              - title: 集群编辑/删除
                code: cluster_edit
                permission: 3
                children: []
          - title: 添加集群
            code: 'sub_menu_cluster_edit'
            permission: 3
            children: []
      - title: 组件管理
        code: 'sub_menu_product_manage'
        permission: 7
        children:
          - title: 组件列表
            code: 'sub_menu_product_list'
            permission: 7
            children:
              - title: 查看
                code: 'package_view'
                permission: 7
                children: []
              - title: 产品包上传/删除
                code: 'package_upload_delete'
                permission: 3
                children: []
              - title: 产品包部署
                code: 'package_upload_deploy'
                permission: 3
                children: []
          - title: 部署组件
            code: 'sub_menu_product_deploy'
            permission: 1
            children: []
          - title: 查看进度
            code: 'sub_menu_service_view_progress'
            permission: 1
            children: []
          - title: 重新部署权限
            code: 'sub_menu_service_deploy_again'
            permission: 1
            children: []
          - title: 卸载权限
            code: 'sub_menu_component_delete'
            permission: 1
            children: []
          - title: 强制停止
            code: 'sub_menu_service_delete_force'
            permission: 1
            children: []
          - title: 强制卸载
            code: 'sub_menu_service_stop_force'
            permission: 1
            children: []
          - title: 停止卸载
            code: 'sub_menu_service_stop_delete'
            permission: 1
            children: []
      - title: 监控告警
        code: 'sub_menu_monitor'
        permission: 7
        children:
          - title: 仪表盘
            code: 'sub_menu_dashboard'
            permission: 7
            children: []
          - title: 告警
            code: 'sub_menu_alert'
            permission: 7
            children:
              - title: 告警规则
                code: 'sub_menu_alarm_record'
                permission: 7
                children:
                  - title: 查看
                    code: 'alarm_record_view'
                    permission: 7
                    children: []
                  - title: 开启/关闭告警
                    code: 'alarm_record_open_close'
                    permission: 1
                    children: []
              - title: 告警通道
                code: 'sub_menu_alarm_channel'
                permission: 7
                children:
                  - title: 查看
                    code: 'alarm_channel_view'
                    permission: 7
                    children: []
                  - title: 编辑
                    code: 'alarm_channel_edit'
                    permission: 3
                    children: []
          - title: 仪表盘操作
            code: 'sub_menu_service_grafana_edit'
            permission: 1
            children: []
  - title: 部署向导
    code: 'menu_deploy_guide'
    permission: 1
    children: []
  - title: 用户管理
    code: 'menu_user_manage'
    permission: 7
    children:
      - title: 成员管理
        code: 'sub_menu_user_manage'
        permission: 1
        children:
          - title: 查看
            code: 'user_view'
            permission: 1
            children: []
          - title: 添加用户
            code: 'user_add'
            permission: 1
            children: []
          - title: 编辑用户
            code: 'user_edit'
            permission: 1
            children: []
          - title: 删除用户
            code: 'user_delete'
            permission: 1
            children: []
          - title: 禁用/启用用户
            code: 'user_able_disable'
            permission: 1
            children: []
          - title: 重置密码
            code: 'user_reset_password'
            permission: 1
            children: []
      - title: 角色管理
        code: 'sub_menu_role_manage'
        permission: 3
        children: []
      - title: 个人信息
        code: 'sub_menu_user_info'
        permission: 7
        children: []
      - title: 安全审计
        code: 'menu_security_audit'
        permission: 7
        children: []
      - title: 部署信息下载
        code: 'menu_deploy_info_markdown_download'
        permission: 3
        children: []
  - title: 系统配置
    code: 'menu_system_configuration'
    permission: 1
    children:
      - title: 平台安全
        code: 'sub_menu_configuration_platformsecurity_config'
        permission: 1
        children:
          - title: 查看
            code: 'sub_menu_configuration_platformsecurity_config_view'
            permission: 1
            children: []
          - title: 编辑
            code: 'sub_menu_configuration_platformsecurity_config_edit'
            permission: 1
            children: []
      - title: 全局配置
        code: 'sub_menu_configuration_global_config'
        permission: 3
        children:
          - title: 查看
            code: 'sub_menu_configuration_global_config_view'
            permission: 3
            children: []
          - title: 编辑
            code: 'sub_menu_configuration_global_config_edit'
            permission: 3
            children: []
  - title: 平台管理
    code: 'menu_platform_manager'
    permission: 7
    children:
      - title: 备份配置
        code: 'sub_menu_configuration_backup_config'
        permission: 1
        children:
          - title: 备份编辑
            code: 'sub_menu_backup_config_modify'
            permission: 1
            children: []
          - title: 备份查询
            code: 'sub_menu_backup_config_view'
            permission: 1
            children: []
      - title: 脚本管理
        code: 'sub_menu_platform_manager_scriptManager'
        permission: 7
        children:
          - title: 查看
            code: 'sub_menu_platform_manager_scriptManager_view'
            permission: 7
            children: []
          - title: 编辑
            code: 'sub_menu_configuration_platformsecurity_edit'
            permission: 3
            children: []
  - title: 集群巡检
    code: 'sub_menu_platform_manager_cluster_inspection'
    permission: 7
    children:
      - title: 查看
        code: 'sub_menu_platform_manager_cluster_inspection_view'
        permission: 7
        children: [ ]
      - title: 编辑
        code: 'sub_menu_platform_manager_cluster_inspection_edit'
        permission: 3
        children: [ ]
`)

func templatesRolePermissionsYmlBytes() ([]byte, error) {
	return _templatesRolePermissionsYml, nil
}

func templatesRolePermissionsYml() (*asset, error) {
	bytes, err := templatesRolePermissionsYmlBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/role-permissions.yml", size: 13227, mode: os.FileMode(420), modTime: time.Unix(1652840620, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesSelfbuildComponentV1beta1Yml = []byte(`---

apiVersion: v1
kind: Namespace
metadata:
  name: dtstack-system

---

apiVersion: v1
kind: ServiceAccount
metadata:
  name: dtstack
  namespace: dtstack-system

---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: dtstack-admin-binding
  namespace: dtstack-system
  labels:
    cubepaas.com/creator: "linkcloud"
subjects:
  - kind: ServiceAccount
    name: dtstack
    namespace: dtstack-system
roleRef:
  kind: ClusterRole
  name: dtstack-admin
  apiGroup: rbac.authorization.k8s.io

---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: dtstack-admin
  labels:
    cubepaas.com/creator: "huanxiong"
rules:
  - apiGroups:
      - '*'
    resources:
      - '*'
    verbs:
      - '*'
  - nonResourceURLs:
      - '*'
    verbs:
      - '*'

---

apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: easyagent
  namespace: dtstack-system
  labels:
    k8s-app: easyagent
    kubernetes.io/cluster-service: "true"
spec:
  selector:
    matchLabels:
      app: easyagent
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 5
  template:
    metadata:
      labels:
        app: easyagent
      # This annotation ensures that easyagent does not get evicted if the node
      # supports critical pod annotation based priority scheme.
      # Note that this does not guarantee admission on the nodes (#40573).
      annotations:
        scheduler.alpha.kubernetes.io/critical-pod: ''
        scheduler.alpha.kubernetes.io/tolerations: '[{"key": "node.alpha.kubernetes.io/ismaster", "effect": "NoSchedule"}]'
    spec:
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
      serviceAccountName: dtstack
      imagePullSecrets:
        - name: dtstack
      tolerations:
        - key: "node-role.kubernetes.io/etcd"
          operator: "Equal"
          value: "true"
          effect: "NoExecute"
        - key: "node-role.kubernetes.io/controlplane"
          operator: "Equal"
          value: "true"
          effect: "NoSchedule"
        - key: "node-role.kubernetes.io/master"
          effect: "NoSchedule"
      containers:
        - name: easyagent
          image: registry.cn-hangzhou.aliyuncs.com/dtstack/easyagent:v4.1.1-beta
          ports:
            - containerPort: 7788
          resources:
            limits:
              memory: 200Mi
              cpu: 200m
          env:
            - name: SERVER
              value: {{.SERVER}}
            - name: CallBack
              value: {{.CALLBACK}}
            - name: RootPath
              value: /host
          volumeMounts:
            - name: sock
              mountPath: /var/run/docker.sock
            - name: agents
              mountPath: /sidecar/agents
            - name: conf
              mountPath: /sidecar/conf
            - name: root
              mountPath: /host
              readOnly: true

      volumes:
        - name: sock
          hostPath:
            path: /var/run/docker.sock
        - name: agents
          hostPath:
            path: /dtstack/easymanager/agents
        - name: conf
          hostPath:
            path: /dtstack/easymanager/conf
        - name: root
          hostPath:
            path: /

---

apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: moles.operator.dtstack.com
spec:
  group: operator.dtstack.com
  names:
    kind: Mole
    listKind: MoleList
    plural: moles
    singular: mole
  scope: Namespaced
  validation:
    openAPIV3Schema:
      properties:
        apiVersion:
          type: string
        kind:
          type: string
        metadata:
          type: object
        spec:
          properties:
            product:
              properties:
                cluster_id:
                  type: integer
                deploy_uuid:
                  type: string
                imagePullSecret:
                  type: string
                parent_product_name:
                  type: string
                pid:
                  type: integer
                product_name:
                  type: string
                product_name_display:
                  type: string
                product_version:
                  type: string
                service:
                  additionalProperties:
                    properties:
                      base_attribute:
                        type: string
                      base_parsed:
                        type: boolean
                      base_product:
                        type: string
                      base_service:
                        type: string
                      depends_on:
                        items:
                          type: string
                        type: array
                      group:
                        type: string
                      instance:
                        properties:
                          cmd:
                            type: string
                          config_path:
                            items:
                              type: string
                            type: array
                          data_dir:
                            items:
                              type: string
                            type: array
                          deployment:
                            properties:
                              affinity:
                                properties:
                                  nodeAffinity:
                                    properties:
                                      preferredDuringSchedulingIgnoredDuringExecution:
                                        items:
                                          properties:
                                            preference:
                                              properties:
                                                matchExpressions:
                                                  items:
                                                    properties:
                                                      key:
                                                        type: string
                                                      operator:
                                                        type: string
                                                      values:
                                                        items:
                                                          type: string
                                                        type: array
                                                    required:
                                                      - key
                                                      - operator
                                                    type: object
                                                  type: array
                                                matchFields:
                                                  items:
                                                    properties:
                                                      key:
                                                        type: string
                                                      operator:
                                                        type: string
                                                      values:
                                                        items:
                                                          type: string
                                                        type: array
                                                    required:
                                                      - key
                                                      - operator
                                                    type: object
                                                  type: array
                                              type: object
                                            weight:
                                              format: int32
                                              type: integer
                                          required:
                                            - preference
                                            - weight
                                          type: object
                                        type: array
                                      requiredDuringSchedulingIgnoredDuringExecution:
                                        properties:
                                          nodeSelectorTerms:
                                            items:
                                              properties:
                                                matchExpressions:
                                                  items:
                                                    properties:
                                                      key:
                                                        type: string
                                                      operator:
                                                        type: string
                                                      values:
                                                        items:
                                                          type: string
                                                        type: array
                                                    required:
                                                      - key
                                                      - operator
                                                    type: object
                                                  type: array
                                                matchFields:
                                                  items:
                                                    properties:
                                                      key:
                                                        type: string
                                                      operator:
                                                        type: string
                                                      values:
                                                        items:
                                                          type: string
                                                        type: array
                                                    required:
                                                      - key
                                                      - operator
                                                    type: object
                                                  type: array
                                              type: object
                                            type: array
                                        required:
                                          - nodeSelectorTerms
                                        type: object
                                    type: object
                                  podAffinity:
                                    properties:
                                      preferredDuringSchedulingIgnoredDuringExecution:
                                        items:
                                          properties:
                                            podAffinityTerm:
                                              properties:
                                                labelSelector:
                                                  properties:
                                                    matchExpressions:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                    matchLabels:
                                                      additionalProperties:
                                                        type: string
                                                      type: object
                                                  type: object
                                                namespaces:
                                                  items:
                                                    type: string
                                                  type: array
                                                topologyKey:
                                                  type: string
                                              required:
                                                - topologyKey
                                              type: object
                                            weight:
                                              format: int32
                                              type: integer
                                          required:
                                            - podAffinityTerm
                                            - weight
                                          type: object
                                        type: array
                                      requiredDuringSchedulingIgnoredDuringExecution:
                                        items:
                                          properties:
                                            labelSelector:
                                              properties:
                                                matchExpressions:
                                                  items:
                                                    properties:
                                                      key:
                                                        type: string
                                                      operator:
                                                        type: string
                                                      values:
                                                        items:
                                                          type: string
                                                        type: array
                                                    required:
                                                      - key
                                                      - operator
                                                    type: object
                                                  type: array
                                                matchLabels:
                                                  additionalProperties:
                                                    type: string
                                                  type: object
                                              type: object
                                            namespaces:
                                              items:
                                                type: string
                                              type: array
                                            topologyKey:
                                              type: string
                                          required:
                                            - topologyKey
                                          type: object
                                        type: array
                                    type: object
                                  podAntiAffinity:
                                    properties:
                                      preferredDuringSchedulingIgnoredDuringExecution:
                                        items:
                                          properties:
                                            podAffinityTerm:
                                              properties:
                                                labelSelector:
                                                  properties:
                                                    matchExpressions:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                    matchLabels:
                                                      additionalProperties:
                                                        type: string
                                                      type: object
                                                  type: object
                                                namespaces:
                                                  items:
                                                    type: string
                                                  type: array
                                                topologyKey:
                                                  type: string
                                              required:
                                                - topologyKey
                                              type: object
                                            weight:
                                              format: int32
                                              type: integer
                                          required:
                                            - podAffinityTerm
                                            - weight
                                          type: object
                                        type: array
                                      requiredDuringSchedulingIgnoredDuringExecution:
                                        items:
                                          properties:
                                            labelSelector:
                                              properties:
                                                matchExpressions:
                                                  items:
                                                    properties:
                                                      key:
                                                        type: string
                                                      operator:
                                                        type: string
                                                      values:
                                                        items:
                                                          type: string
                                                        type: array
                                                    required:
                                                      - key
                                                      - operator
                                                    type: object
                                                  type: array
                                                matchLabels:
                                                  additionalProperties:
                                                    type: string
                                                  type: object
                                              type: object
                                            namespaces:
                                              items:
                                                type: string
                                              type: array
                                            topologyKey:
                                              type: string
                                          required:
                                            - topologyKey
                                          type: object
                                        type: array
                                    type: object
                                type: object
                              annotations:
                                additionalProperties:
                                  type: string
                                type: object
                              containers:
                                items:
                                  properties:
                                    image:
                                      type: string
                                    name:
                                      type: string
                                  type: object
                                type: array
                              image:
                                type: string
                              labels:
                                additionalProperties:
                                  type: string
                                type: object
                              nodeSelector:
                                additionalProperties:
                                  type: string
                                type: object
                              ports:
                                items:
                                  type: integer
                                type: array
                              replicas:
                                format: int32
                                type: integer
                              resources:
                                properties:
                                  limits:
                                    additionalProperties:
                                      anyOf:
                                        - type: integer
                                        - type: string
                                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                      x-kubernetes-int-or-string: true
                                    type: object
                                  requests:
                                    additionalProperties:
                                      anyOf:
                                        - type: integer
                                        - type: string
                                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                      x-kubernetes-int-or-string: true
                                    type: object
                                type: object
                              securityContext:
                                properties:
                                  fsGroup:
                                    format: int64
                                    type: integer
                                  fsGroupChangePolicy:
                                    type: string
                                  runAsGroup:
                                    format: int64
                                    type: integer
                                  runAsNonRoot:
                                    type: boolean
                                  runAsUser:
                                    format: int64
                                    type: integer
                                  seLinuxOptions:
                                    properties:
                                      level:
                                        type: string
                                      role:
                                        type: string
                                      type:
                                        type: string
                                      user:
                                        type: string
                                    type: object
                                  supplementalGroups:
                                    items:
                                      format: int64
                                      type: integer
                                    type: array
                                  sysctls:
                                    items:
                                      properties:
                                        name:
                                          type: string
                                        value:
                                          type: string
                                      required:
                                        - name
                                        - value
                                      type: object
                                    type: array
                                  windowsOptions:
                                    properties:
                                      gmsaCredentialSpec:
                                        type: string
                                      gmsaCredentialSpecName:
                                        type: string
                                      runAsUserName:
                                        type: string
                                    type: object
                                type: object
                              terminationGracePeriodSeconds:
                                format: int64
                                type: integer
                              tolerations:
                                items:
                                  properties:
                                    effect:
                                      type: string
                                    key:
                                      type: string
                                    operator:
                                      type: string
                                    tolerationSeconds:
                                      format: int64
                                      type: integer
                                    value:
                                      type: string
                                  type: object
                                type: array
                            type: object
                          environment:
                            additionalProperties:
                              type: string
                            type: object
                          ingress:
                            properties:
                              annotations:
                                additionalProperties:
                                  type: string
                                type: object
                              enabled:
                                type: boolean
                              hostname:
                                type: string
                              labels:
                                additionalProperties:
                                  type: string
                                type: object
                              path:
                                type: string
                              targetPort:
                                type: string
                              tlsEnabled:
                                type: boolean
                              tlsSecretName:
                                type: string
                            type: object
                          logs:
                            items:
                              type: string
                            type: array
                          post_deploy:
                            type: string
                          prometheus_port:
                            type: string
                          resources:
                            properties:
                              limits:
                                additionalProperties:
                                  anyOf:
                                    - type: integer
                                    - type: string
                                  pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                  x-kubernetes-int-or-string: true
                                type: object
                              requests:
                                additionalProperties:
                                  anyOf:
                                    - type: integer
                                    - type: string
                                  pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                  x-kubernetes-int-or-string: true
                                type: object
                            type: object
                          service:
                            properties:
                              annotations:
                                additionalProperties:
                                  type: string
                                type: object
                              labels:
                                additionalProperties:
                                  type: string
                                type: object
                              ports:
                                items:
                                  properties:
                                    appProtocol:
                                      type: string
                                    name:
                                      type: string
                                    nodePort:
                                      format: int32
                                      type: integer
                                    port:
                                      format: int32
                                      type: integer
                                    protocol:
                                      type: string
                                    targetPort:
                                      anyOf:
                                        - type: integer
                                        - type: string
                                      x-kubernetes-int-or-string: true
                                  required:
                                    - port
                                  type: object
                                type: array
                              type:
                                type: string
                            type: object
                        type: object
                      is_deploy_ingress:
                        type: boolean
                      is_job:
                        type: boolean
                      service_display:
                        type: string
                      version:
                        type: string
                    type: object
                  type: object
              required:
                - service
              type: object
          type: object
        status:
          properties:
            message:
              type: string
            phase:
              type: string
          required:
            - message
            - phase
          type: object
      type: object
  version: v1
  versions:
    - name: v1
      served: true
      storage: true


---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: mole-operator
  namespace: dtstack-system
spec:
  replicas: 1
  selector:
    matchLabels:
      name: mole-operator
  template:
    metadata:
      labels:
        name: mole-operator
    spec:
      serviceAccountName: dtstack
      imagePullSecrets:
        - name: dtstack
      containers:
        - name: mole-operator
          image: registry.cn-hangzhou.aliyuncs.com/dtstack/mole:v1.0.13
          imagePullPolicy: Always
          command:
            - mole-operator
          env:
            - name: WATCH_NAMESPACE
              value: "dtstack-system"
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: OPERATOR_NAME
              value: "mole-operator"


---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: easymonitor
  namespace: dtstack-system
spec:
  replicas: 1
  selector:
    matchLabels:
      name: easymonitor
  template:
    metadata:
      labels:
        name: easymonitor
    spec:
      serviceAccountName: dtstack
      imagePullSecrets:
        - name: dtstack
      containers:
        - name: easymonitor
          image: registry.cn-hangzhou.aliyuncs.com/dtstack/easymonitor:v1.0.2
          imagePullPolicy: Always
          env:
            - name: SERVER
              value: {{.SERVER}}
            - name: WATCH_NAMESPACE
              value: "dtstack-system"
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
`)

func templatesSelfbuildComponentV1beta1YmlBytes() ([]byte, error) {
	return _templatesSelfbuildComponentV1beta1Yml, nil
}

func templatesSelfbuildComponentV1beta1Yml() (*asset, error) {
	bytes, err := templatesSelfbuildComponentV1beta1YmlBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/selfbuild-component-v1beta1.yml", size: 35215, mode: os.FileMode(420), modTime: time.Unix(1638428450, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

var _templatesSelfbuildComponentYml = []byte(`---

apiVersion: v1
kind: Namespace
metadata:
  name: dtstack-system

---

apiVersion: v1
kind: ServiceAccount
metadata:
  name: dtstack
  namespace: dtstack-system

---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: dtstack-admin-binding
  namespace: dtstack-system
  labels:
    cubepaas.com/creator: "linkcloud"
subjects:
  - kind: ServiceAccount
    name: dtstack
    namespace: dtstack-system
roleRef:
  kind: ClusterRole
  name: dtstack-admin
  apiGroup: rbac.authorization.k8s.io

---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: dtstack-admin
  labels:
    cubepaas.com/creator: "huanxiong"
rules:
  - apiGroups:
      - '*'
    resources:
      - '*'
    verbs:
      - '*'
  - nonResourceURLs:
      - '*'
    verbs:
      - '*'

---

apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: easyagent
  namespace: dtstack-system
  labels:
    k8s-app: easyagent
    kubernetes.io/cluster-service: "true"
spec:
  selector:
    matchLabels:
      app: easyagent
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 5
  template:
    metadata:
      labels:
        app: easyagent
      # This annotation ensures that easyagent does not get evicted if the node
      # supports critical pod annotation based priority scheme.
      # Note that this does not guarantee admission on the nodes (#40573).
      annotations:
        scheduler.alpha.kubernetes.io/critical-pod: ''
        scheduler.alpha.kubernetes.io/tolerations: '[{"key": "node.alpha.kubernetes.io/ismaster", "effect": "NoSchedule"}]'
    spec:
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
      serviceAccountName: dtstack
      imagePullSecrets:
        - name: dtstack
      tolerations:
        - key: "node-role.kubernetes.io/etcd"
          operator: "Equal"
          value: "true"
          effect: "NoExecute"
        - key: "node-role.kubernetes.io/controlplane"
          operator: "Equal"
          value: "true"
          effect: "NoSchedule"
        - key: "node-role.kubernetes.io/master"
          effect: "NoSchedule"
      containers:
        - name: easyagent
          image: registry.cn-hangzhou.aliyuncs.com/dtstack/easyagent:v4.1.1-beta
          imagePullPolicy: Always
          ports:
            - containerPort: 8899
          resources:
            limits:
              memory: 200Mi
              cpu: 200m
          env:
            - name: SERVER
              value: {{.SERVER}}
            - name: CallBack
              value: {{.CALLBACK}}
            - name: RootPath
              value: /host
          volumeMounts:
            - name: sock
              mountPath: /var/run/docker.sock
            - name: agents
              mountPath: /sidecar/agents
            - name: conf
              mountPath: /sidecar/conf
            - name: root
              mountPath: /host
              readOnly: true

      volumes:
        - name: sock
          hostPath:
            path: /var/run/docker.sock
        - name: agents
          hostPath:
            path: /dtstack/easymanager/agents
        - name: conf
          hostPath:
            path: /dtstack/easymanager/conf
        - name: root
          hostPath:
            path: /

---

apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: moles.operator.dtstack.com
spec:
  group: operator.dtstack.com
  names:
    kind: Mole
    listKind: MoleList
    plural: moles
    singular: mole
  scope: Namespaced
  versions:
    - name: v1
      schema:
        openAPIV3Schema:
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              properties:
                product:
                  properties:
                    cluster_id:
                      type: integer
                    deploy_uuid:
                      type: string
                    imagePullSecret:
                      type: string
                    parent_product_name:
                      type: string
                    pid:
                      type: integer
                    product_name:
                      type: string
                    product_name_display:
                      type: string
                    product_version:
                      type: string
                    service:
                      additionalProperties:
                        properties:
                          base_attribute:
                            type: string
                          base_parsed:
                            type: boolean
                          base_product:
                            type: string
                          base_service:
                            type: string
                          depends_on:
                            items:
                              type: string
                            type: array
                          group:
                            type: string
                          instance:
                            properties:
                              cmd:
                                type: string
                              config_path:
                                items:
                                  type: string
                                type: array
                              data_dir:
                                items:
                                  type: string
                                type: array
                              deployment:
                                properties:
                                  affinity:
                                    properties:
                                      nodeAffinity:
                                        properties:
                                          preferredDuringSchedulingIgnoredDuringExecution:
                                            items:
                                              properties:
                                                preference:
                                                  properties:
                                                    matchExpressions:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                    matchFields:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                  type: object
                                                weight:
                                                  format: int32
                                                  type: integer
                                              required:
                                                - preference
                                                - weight
                                              type: object
                                            type: array
                                          requiredDuringSchedulingIgnoredDuringExecution:
                                            properties:
                                              nodeSelectorTerms:
                                                items:
                                                  properties:
                                                    matchExpressions:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                    matchFields:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                  type: object
                                                type: array
                                            required:
                                              - nodeSelectorTerms
                                            type: object
                                        type: object
                                      podAffinity:
                                        properties:
                                          preferredDuringSchedulingIgnoredDuringExecution:
                                            items:
                                              properties:
                                                podAffinityTerm:
                                                  properties:
                                                    labelSelector:
                                                      properties:
                                                        matchExpressions:
                                                          items:
                                                            properties:
                                                              key:
                                                                type: string
                                                              operator:
                                                                type: string
                                                              values:
                                                                items:
                                                                  type: string
                                                                type: array
                                                            required:
                                                              - key
                                                              - operator
                                                            type: object
                                                          type: array
                                                        matchLabels:
                                                          additionalProperties:
                                                            type: string
                                                          type: object
                                                      type: object
                                                    namespaces:
                                                      items:
                                                        type: string
                                                      type: array
                                                    topologyKey:
                                                      type: string
                                                  required:
                                                    - topologyKey
                                                  type: object
                                                weight:
                                                  format: int32
                                                  type: integer
                                              required:
                                                - podAffinityTerm
                                                - weight
                                              type: object
                                            type: array
                                          requiredDuringSchedulingIgnoredDuringExecution:
                                            items:
                                              properties:
                                                labelSelector:
                                                  properties:
                                                    matchExpressions:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                    matchLabels:
                                                      additionalProperties:
                                                        type: string
                                                      type: object
                                                  type: object
                                                namespaces:
                                                  items:
                                                    type: string
                                                  type: array
                                                topologyKey:
                                                  type: string
                                              required:
                                                - topologyKey
                                              type: object
                                            type: array
                                        type: object
                                      podAntiAffinity:
                                        properties:
                                          preferredDuringSchedulingIgnoredDuringExecution:
                                            items:
                                              properties:
                                                podAffinityTerm:
                                                  properties:
                                                    labelSelector:
                                                      properties:
                                                        matchExpressions:
                                                          items:
                                                            properties:
                                                              key:
                                                                type: string
                                                              operator:
                                                                type: string
                                                              values:
                                                                items:
                                                                  type: string
                                                                type: array
                                                            required:
                                                              - key
                                                              - operator
                                                            type: object
                                                          type: array
                                                        matchLabels:
                                                          additionalProperties:
                                                            type: string
                                                          type: object
                                                      type: object
                                                    namespaces:
                                                      items:
                                                        type: string
                                                      type: array
                                                    topologyKey:
                                                      type: string
                                                  required:
                                                    - topologyKey
                                                  type: object
                                                weight:
                                                  format: int32
                                                  type: integer
                                              required:
                                                - podAffinityTerm
                                                - weight
                                              type: object
                                            type: array
                                          requiredDuringSchedulingIgnoredDuringExecution:
                                            items:
                                              properties:
                                                labelSelector:
                                                  properties:
                                                    matchExpressions:
                                                      items:
                                                        properties:
                                                          key:
                                                            type: string
                                                          operator:
                                                            type: string
                                                          values:
                                                            items:
                                                              type: string
                                                            type: array
                                                        required:
                                                          - key
                                                          - operator
                                                        type: object
                                                      type: array
                                                    matchLabels:
                                                      additionalProperties:
                                                        type: string
                                                      type: object
                                                  type: object
                                                namespaces:
                                                  items:
                                                    type: string
                                                  type: array
                                                topologyKey:
                                                  type: string
                                              required:
                                                - topologyKey
                                              type: object
                                            type: array
                                        type: object
                                    type: object
                                  annotations:
                                    additionalProperties:
                                      type: string
                                    type: object
                                  containers:
                                    items:
                                      properties:
                                        image:
                                          type: string
                                        name:
                                          type: string
                                      type: object
                                    type: array
                                  image:
                                    type: string
                                  labels:
                                    additionalProperties:
                                      type: string
                                    type: object
                                  nodeSelector:
                                    additionalProperties:
                                      type: string
                                    type: object
                                  ports:
                                    items:
                                      type: integer
                                    type: array
                                  replicas:
                                    format: int32
                                    type: integer
                                  resources:
                                    properties:
                                      limits:
                                        additionalProperties:
                                          anyOf:
                                            - type: integer
                                            - type: string
                                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                          x-kubernetes-int-or-string: true
                                        type: object
                                      requests:
                                        additionalProperties:
                                          anyOf:
                                            - type: integer
                                            - type: string
                                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                          x-kubernetes-int-or-string: true
                                        type: object
                                    type: object
                                  securityContext:
                                    properties:
                                      fsGroup:
                                        format: int64
                                        type: integer
                                      fsGroupChangePolicy:
                                        type: string
                                      runAsGroup:
                                        format: int64
                                        type: integer
                                      runAsNonRoot:
                                        type: boolean
                                      runAsUser:
                                        format: int64
                                        type: integer
                                      seLinuxOptions:
                                        properties:
                                          level:
                                            type: string
                                          role:
                                            type: string
                                          type:
                                            type: string
                                          user:
                                            type: string
                                        type: object
                                      supplementalGroups:
                                        items:
                                          format: int64
                                          type: integer
                                        type: array
                                      sysctls:
                                        items:
                                          properties:
                                            name:
                                              type: string
                                            value:
                                              type: string
                                          required:
                                            - name
                                            - value
                                          type: object
                                        type: array
                                      windowsOptions:
                                        properties:
                                          gmsaCredentialSpec:
                                            type: string
                                          gmsaCredentialSpecName:
                                            type: string
                                          runAsUserName:
                                            type: string
                                        type: object
                                    type: object
                                  terminationGracePeriodSeconds:
                                    format: int64
                                    type: integer
                                  tolerations:
                                    items:
                                      properties:
                                        effect:
                                          type: string
                                        key:
                                          type: string
                                        operator:
                                          type: string
                                        tolerationSeconds:
                                          format: int64
                                          type: integer
                                        value:
                                          type: string
                                      type: object
                                    type: array
                                type: object
                              environment:
                                additionalProperties:
                                  type: string
                                type: object
                              ingress:
                                properties:
                                  annotations:
                                    additionalProperties:
                                      type: string
                                    type: object
                                  enabled:
                                    type: boolean
                                  hostname:
                                    type: string
                                  labels:
                                    additionalProperties:
                                      type: string
                                    type: object
                                  path:
                                    type: string
                                  targetPort:
                                    type: string
                                  tlsEnabled:
                                    type: boolean
                                  tlsSecretName:
                                    type: string
                                type: object
                              logs:
                                items:
                                  type: string
                                type: array
                              post_deploy:
                                type: string
                              prometheus_port:
                                type: string
                              resources:
                                properties:
                                  limits:
                                    additionalProperties:
                                      anyOf:
                                        - type: integer
                                        - type: string
                                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                      x-kubernetes-int-or-string: true
                                    type: object
                                  requests:
                                    additionalProperties:
                                      anyOf:
                                        - type: integer
                                        - type: string
                                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                                      x-kubernetes-int-or-string: true
                                    type: object
                                type: object
                              service:
                                properties:
                                  annotations:
                                    additionalProperties:
                                      type: string
                                    type: object
                                  labels:
                                    additionalProperties:
                                      type: string
                                    type: object
                                  ports:
                                    items:
                                      properties:
                                        appProtocol:
                                          type: string
                                        name:
                                          type: string
                                        nodePort:
                                          format: int32
                                          type: integer
                                        port:
                                          format: int32
                                          type: integer
                                        protocol:
                                          type: string
                                        targetPort:
                                          anyOf:
                                            - type: integer
                                            - type: string
                                          x-kubernetes-int-or-string: true
                                      required:
                                        - port
                                      type: object
                                    type: array
                                  type:
                                    type: string
                                type: object
                            type: object
                          is_deploy_ingress:
                            type: boolean
                          is_job:
                            type: boolean
                          service_display:
                            type: string
                          version:
                            type: string
                        type: object
                      type: object
                  required:
                    - service
                  type: object
              type: object
            status:
              properties:
                message:
                  type: string
                phase:
                  type: string
              required:
                - message
                - phase
              type: object
          type: object
      served: true
      storage: true

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: mole-operator
  namespace: dtstack-system
spec:
  replicas: 1
  selector:
    matchLabels:
      name: mole-operator
  template:
    metadata:
      labels:
        name: mole-operator
    spec:
      serviceAccountName: dtstack
      imagePullSecrets:
        - name: dtstack
      containers:
        - name: mole-operator
          image: registry.cn-hangzhou.aliyuncs.com/dtstack/mole:v1.0.17
          imagePullPolicy: Always
          command:
            - mole-operator
          env:
            - name: WATCH_NAMESPACE
              value: "dtstack-system"
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: OPERATOR_NAME
              value: "mole-operator"


---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: easymonitor
  namespace: dtstack-system
spec:
  replicas: 1
  selector:
    matchLabels:
      name: easymonitor
  template:
    metadata:
      labels:
        name: easymonitor
    spec:
      serviceAccountName: dtstack
      imagePullSecrets:
      - name: dtstack
      containers:
      - name: easymonitor
        image: registry.cn-hangzhou.aliyuncs.com/dtstack/easymonitor:v1.0.2
        imagePullPolicy: Always
        env:
        - name: SERVER
          value: {{.SERVER}}
        - name: WATCH_NAMESPACE
          value: "dtstack-system"
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
`)

func templatesSelfbuildComponentYmlBytes() ([]byte, error) {
	return _templatesSelfbuildComponentYml, nil
}

func templatesSelfbuildComponentYml() (*asset, error) {
	bytes, err := templatesSelfbuildComponentYmlBytes()
	if err != nil {
		return nil, err
	}

	info := bindataFileInfo{name: "templates/selfbuild-component.yml", size: 36636, mode: os.FileMode(420), modTime: time.Unix(1638428450, 0)}
	a := &asset{bytes: bytes, info: info}
	return a, nil
}

// Asset loads and returns the asset for the given name.
// It returns an error if the asset could not be found or
// could not be loaded.
func Asset(name string) ([]byte, error) {
	cannonicalName := strings.Replace(name, "\\", "/", -1)
	if f, ok := _bindata[cannonicalName]; ok {
		a, err := f()
		if err != nil {
			return nil, fmt.Errorf("Asset %s can't read by error: %v", name, err)
		}
		return a.bytes, nil
	}
	return nil, fmt.Errorf("Asset %s not found", name)
}

// MustAsset is like Asset but panics when Asset would return an error.
// It simplifies safe initialization of global variables.
func MustAsset(name string) []byte {
	a, err := Asset(name)
	if err != nil {
		panic("asset: Asset(" + name + "): " + err.Error())
	}

	return a
}

// AssetInfo loads and returns the asset info for the given name.
// It returns an error if the asset could not be found or
// could not be loaded.
func AssetInfo(name string) (os.FileInfo, error) {
	cannonicalName := strings.Replace(name, "\\", "/", -1)
	if f, ok := _bindata[cannonicalName]; ok {
		a, err := f()
		if err != nil {
			return nil, fmt.Errorf("AssetInfo %s can't read by error: %v", name, err)
		}
		return a.info, nil
	}
	return nil, fmt.Errorf("AssetInfo %s not found", name)
}

// AssetNames returns the names of the assets.
func AssetNames() []string {
	names := make([]string, 0, len(_bindata))
	for name := range _bindata {
		names = append(names, name)
	}
	return names
}

// _bindata is a table, holding each asset generator, mapped to its name.
var _bindata = map[string]func() (*asset, error){
	"templates/check-agent-exit.sh":                 templatesCheckAgentExitSh,
	"templates/cluster-net-check.sh":                templatesClusterNetCheckSh,
	"templates/docker.environment.init.sh":          templatesDockerEnvironmentInitSh,
	"templates/environment.init.sh":                 templatesEnvironmentInitSh,
	"templates/health-check.sh":                     templatesHealthCheckSh,
	"templates/import-cluster-resource-v1beta1.yml": templatesImportClusterResourceV1beta1Yml,
	"templates/import-cluster-resource.yml":         templatesImportClusterResourceYml,
	"templates/import-ns-resouce.yml":               templatesImportNsResouceYml,
	"templates/install.agentx.sh":                   templatesInstallAgentxSh,
	"templates/install.script.wrapper.sh":           templatesInstallScriptWrapperSh,
	"templates/list-files.sh":                       templatesListFilesSh,
	"templates/net-check.sh":                        templatesNetCheckSh,
	"templates/patchupdate.sh":                      templatesPatchupdateSh,
	"templates/role-permissions.yml":                templatesRolePermissionsYml,
	"templates/selfbuild-component-v1beta1.yml":     templatesSelfbuildComponentV1beta1Yml,
	"templates/selfbuild-component.yml":             templatesSelfbuildComponentYml,
}

// AssetDir returns the file names below a certain
// directory embedded in the file by go-bindata.
// For example if you run go-bindata on data/... and data contains the
// following hierarchy:
//     data/
//       foo.txt
//       img/
//         a.png
//         b.png
// then AssetDir("data") would return []string{"foo.txt", "img"}
// AssetDir("data/img") would return []string{"a.png", "b.png"}
// AssetDir("foo.txt") and AssetDir("notexist") would return an error
// AssetDir("") will return []string{"data"}.
func AssetDir(name string) ([]string, error) {
	node := _bintree
	if len(name) != 0 {
		cannonicalName := strings.Replace(name, "\\", "/", -1)
		pathList := strings.Split(cannonicalName, "/")
		for _, p := range pathList {
			node = node.Children[p]
			if node == nil {
				return nil, fmt.Errorf("Asset %s not found", name)
			}
		}
	}
	if node.Func != nil {
		return nil, fmt.Errorf("Asset %s not found", name)
	}
	rv := make([]string, 0, len(node.Children))
	for childName := range node.Children {
		rv = append(rv, childName)
	}
	return rv, nil
}

type bintree struct {
	Func     func() (*asset, error)
	Children map[string]*bintree
}

var _bintree = &bintree{nil, map[string]*bintree{
	"templates": &bintree{nil, map[string]*bintree{
		"check-agent-exit.sh":                 &bintree{templatesCheckAgentExitSh, map[string]*bintree{}},
		"cluster-net-check.sh":                &bintree{templatesClusterNetCheckSh, map[string]*bintree{}},
		"docker.environment.init.sh":          &bintree{templatesDockerEnvironmentInitSh, map[string]*bintree{}},
		"environment.init.sh":                 &bintree{templatesEnvironmentInitSh, map[string]*bintree{}},
		"health-check.sh":                     &bintree{templatesHealthCheckSh, map[string]*bintree{}},
		"import-cluster-resource-v1beta1.yml": &bintree{templatesImportClusterResourceV1beta1Yml, map[string]*bintree{}},
		"import-cluster-resource.yml":         &bintree{templatesImportClusterResourceYml, map[string]*bintree{}},
		"import-ns-resouce.yml":               &bintree{templatesImportNsResouceYml, map[string]*bintree{}},
		"install.agentx.sh":                   &bintree{templatesInstallAgentxSh, map[string]*bintree{}},
		"install.script.wrapper.sh":           &bintree{templatesInstallScriptWrapperSh, map[string]*bintree{}},
		"list-files.sh":                       &bintree{templatesListFilesSh, map[string]*bintree{}},
		"net-check.sh":                        &bintree{templatesNetCheckSh, map[string]*bintree{}},
		"patchupdate.sh":                      &bintree{templatesPatchupdateSh, map[string]*bintree{}},
		"role-permissions.yml":                &bintree{templatesRolePermissionsYml, map[string]*bintree{}},
		"selfbuild-component-v1beta1.yml":     &bintree{templatesSelfbuildComponentV1beta1Yml, map[string]*bintree{}},
		"selfbuild-component.yml":             &bintree{templatesSelfbuildComponentYml, map[string]*bintree{}},
	}},
}}

// RestoreAsset restores an asset under the given directory
func RestoreAsset(dir, name string) error {
	data, err := Asset(name)
	if err != nil {
		return err
	}
	info, err := AssetInfo(name)
	if err != nil {
		return err
	}
	err = os.MkdirAll(_filePath(dir, filepath.Dir(name)), os.FileMode(0755))
	if err != nil {
		return err
	}
	err = ioutil.WriteFile(_filePath(dir, name), data, info.Mode())
	if err != nil {
		return err
	}
	err = os.Chtimes(_filePath(dir, name), info.ModTime(), info.ModTime())
	if err != nil {
		return err
	}
	return nil
}

// RestoreAssets restores an asset under the given directory recursively
func RestoreAssets(dir, name string) error {
	children, err := AssetDir(name)
	// File
	if err != nil {
		return RestoreAsset(dir, name)
	}
	// Dir
	for _, child := range children {
		err = RestoreAssets(dir, filepath.Join(name, child))
		if err != nil {
			return err
		}
	}
	return nil
}

func _filePath(dir, name string) string {
	cannonicalName := strings.Replace(name, "\\", "/", -1)
	return filepath.Join(append([]string{dir}, strings.Split(cannonicalName, "/")...)...)
}
